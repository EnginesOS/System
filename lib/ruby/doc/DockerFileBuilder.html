<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class DockerFileBuilder - RDoc Documentation</title>

<link href="./fonts.css" rel="stylesheet">
<link href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/navigation.js"></script>
<script src="./js/search_index.js"></script>
<script src="./js/search.js"></script>
<script src="./js/searcher.js"></script>
<script src="./js/darkfish.js"></script>
<body id="top" role="document" class="class">
	<nav role="navigation">
		<div id="project-navigation">
			<div id="home-section" role="region" title="Quick navigation"
				class="nav-section">
				<h2>
					<a href="./index.html" rel="home">Home</a>
				</h2>

				<div id="table-of-contents-navigation">
					<a href="./table_of_contents.html#pages">Pages</a> <a
						href="./table_of_contents.html#classes">Classes</a> <a
						href="./table_of_contents.html#methods">Methods</a>
				</div>
			</div>

			<div id="search-section" role="search"
				class="project-section initially-hidden">
				<form action="#" method="get" accept-charset="utf-8">
					<div id="search-field-wrapper">
						<input id="search-field" role="combobox" aria-label="Search"
							aria-autocomplete="list" aria-controls="search-results"
							type="text" name="search" placeholder="Search" spellcheck="false"
							title="Type to search, Up and Down to navigate, Enter to load">
					</div>

					<ul id="search-results" aria-label="Search Results"
						aria-busy="false" aria-expanded="false" aria-atomic="false"
						class="initially-hidden"></ul>
				</form>
			</div>

		</div>



		<div id="class-metadata">

			<div id="parent-class-section" class="nav-section">
				<h3>Parent</h3>


				<p class="link">
					<a href="Object.html">Object</a>
			</div>



			<!-- Method Quickref -->
			<div id="method-list-section" class="nav-section">
				<h3>Methods</h3>

				<ul class="link-list" role="directory">

					<li><a href="#method-c-new">::new</a>
					<li><a href="#method-i-chown_home_app">#chown_home_app</a>
					<li><a href="#method-i-count_layer">#count_layer</a>
					<li><a href="#method-i-insert_framework_frag_in_dockerfile">#insert_framework_frag_in_dockerfile</a>
					<li><a href="#method-i-log_build_errors">#log_build_errors</a>
					<li><a href="#method-i-log_build_output">#log_build_output</a>
					<li><a href="#method-i-write_apache_modules">#write_apache_modules</a>
					<li><a href="#method-i-write_app_archives">#write_app_archives</a>
					<li><a href="#method-i-write_clear_env_variables">#write_clear_env_variables</a>
					<li><a href="#method-i-write_container_user">#write_container_user</a>
					<li><a href="#method-i-write_data_permissions">#write_data_permissions</a>
					<li><a href="#method-i-write_environment_variables">#write_environment_variables</a>
					<li><a href="#method-i-write_file_service">#write_file_service</a>
					<li><a href="#method-i-write_files_for_docker">#write_files_for_docker</a>
					<li><a href="#method-i-write_os_packages">#write_os_packages</a>
					<li><a href="#method-i-write_pear_list">#write_pear_list</a>
					<li><a href="#method-i-write_persistent_dirs">#write_persistent_dirs</a>
					<li><a href="#method-i-write_persistent_files">#write_persistent_files</a>
					<li><a href="#method-i-write_rake_list">#write_rake_list</a>
					<li><a href="#method-i-write_run_install_script">#write_run_install_script</a>
					<li><a href="#method-i-write_sed_strings">#write_sed_strings</a>
					<li><a href="#method-i-write_stack_env">#write_stack_env</a>
					<li><a href="#method-i-write_worker_commands">#write_worker_commands</a>
					<li><a href="#method-i-write_write_permissions_recursive">#write_write_permissions_recursive</a>
					<li><a href="#method-i-write_write_permissions_single">#write_write_permissions_single</a>
				</ul>
			</div>

		</div>
	</nav>

	<main role="main" aria-labelledby="class-DockerFileBuilder">
	<h1 id="class-DockerFileBuilder" class="class">class
		DockerFileBuilder</h1>

	<section class="description"></section>




	<section id="5Buntitled-5D" class="documentation-section">









		<section id="public-class-5Buntitled-5D-method-details"
			class="method-section">
			<header>
				<h3>Public Class Methods</h3>
			</header>


			<div id="method-c-new" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">new</span><span class="method-args">(reader,containername,hostname,domain_name,webport,builder)</span>

					<span class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="new-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 3</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span
								class="ruby-identifier">reader</span>,<span
								class="ruby-identifier">containername</span>,<span
								class="ruby-identifier">hostname</span>,<span
								class="ruby-identifier">domain_name</span>,<span
								class="ruby-identifier">webport</span>,<span
								class="ruby-identifier">builder</span>)
  <span class="ruby-ivar">@hostname</span> = <span
								class="ruby-identifier">hostname</span>
  <span class="ruby-ivar">@container_name</span> = <span
								class="ruby-identifier">containername</span>
  <span class="ruby-ivar">@domain_name</span> = <span
								class="ruby-identifier">domain_name</span>
  <span class="ruby-ivar">@webPort</span> = <span
								class="ruby-identifier">webport</span>
  <span class="ruby-ivar">@blueprint_reader</span> = <span
								class="ruby-identifier">reader</span>
  <span class="ruby-ivar">@builder</span>=<span class="ruby-identifier">builder</span>

  <span class="ruby-ivar">@docker_file</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>( <span
								class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">get_basedir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/Dockerfile&quot;</span>,<span
								class="ruby-string">&quot;a&quot;</span>)

  <span class="ruby-ivar">@layer_count</span>=<span class="ruby-value">0</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


		</section>

		<section id="public-instance-5Buntitled-5D-method-details"
			class="method-section">
			<header>
				<h3>Public Instance Methods</h3>
			</header>


			<div id="method-i-chown_home_app" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">chown_home_app</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="chown_home_app-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 388</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">chown_home_app</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Chown App Dir&quot;</span>)
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Dockerfile:Chown&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER 0&quot;</span>)
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN if [ ! -d /home/app ];\\&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;  then \\&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;    mkdir -p /home/app ;\\&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;  fi;\\&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot; mkdir -p /home/fs ; mkdir -p /home/fs/local ;\\&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot; chown -R $ContUser /home/app /home/fs /home/fs/local&quot;</span>)
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER $ContUser&quot;</span>)
    <span class="ruby-identifier">count_layer</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-count_layer" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">count_layer</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="count_layer-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 24</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">count_layer</span>
  <span class="ruby-operator">+</span><span class="ruby-operator">+</span><span
								class="ruby-ivar">@layer_count</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@layer_count</span> <span
								class="ruby-operator">&gt;</span><span class="ruby-value">75</span>
    <span class="ruby-identifier">raise</span> <span
								class="ruby-constant">EngineBuilder</span>.<span
								class="ruby-constant">BuildError</span>.<span
								class="ruby-identifier">new</span>()
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-insert_framework_frag_in_dockerfile"
				class="method-detail ">

				<div class="method-heading">
					<span class="method-name">insert_framework_frag_in_dockerfile</span><span
						class="method-args">(frag_name)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="insert_framework_frag_in_dockerfile-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 374</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">insert_framework_frag_in_dockerfile</span>(<span
								class="ruby-identifier">frag_name</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-identifier">frag_name</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Framework Frag&quot;</span>)
    <span class="ruby-identifier">frame_build_docker_frag</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span
								class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">DeploymentTemplates</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">framework</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/Dockerfile.&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">frag_name</span>)
    <span class="ruby-identifier">builder_frag</span> = <span
								class="ruby-identifier">frame_build_docker_frag</span>.<span
								class="ruby-identifier">read</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">write</span>(<span
								class="ruby-identifier">builder_frag</span>)
    <span class="ruby-identifier">count_layer</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-log_build_errors" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">log_build_errors</span><span
						class="method-args">(line)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="log_build_errors-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-identifier">line</span>)
  <span class="ruby-ivar">@builder</span>.<span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-identifier">line</span>)
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-log_build_output" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">log_build_output</span><span
						class="method-args">(line)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="log_build_output-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 16</span>
<span class="ruby-keyword">def</span>  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-identifier">line</span>)
  <span class="ruby-ivar">@builder</span>.<span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-identifier">line</span>)
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_apache_modules" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_apache_modules</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_apache_modules-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 112</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_apache_modules</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">apache_modules</span>.<span
								class="ruby-identifier">count</span> <span class="ruby-operator">&lt;</span><span
								class="ruby-value">1</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Apache Modules&quot;</span>)
  <span class="ruby-identifier">ap_modules_str</span> = <span
								class="ruby-constant">String</span>.<span
								class="ruby-identifier">new</span>
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">apache_modules</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">ap_module</span><span
								class="ruby-operator">|</span>

    <span class="ruby-identifier">ap_modules_str</span> <span
								class="ruby-operator">+=</span> <span class="ruby-identifier">ap_module</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN a2enmod &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">ap_modules_str</span>)
  <span class="ruby-identifier">count_layer</span>()
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_app_archives" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_app_archives</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_app_archives-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 555</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_app_archives</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#App Archives&quot;</span>)
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Dockerfile:App Archives&quot;</span>)
    <span class="ruby-identifier">n</span>=<span class="ruby-value">0</span>
    <span class="ruby-comment">#        srcs=String.new</span>
    <span class="ruby-comment">#        names=String.new</span>
    <span class="ruby-comment">#        locations=String.new</span>
    <span class="ruby-comment">#        extracts=String.new</span>
    <span class="ruby-comment">#        dirs=String.new</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)

    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">archives_details</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">archive_details</span><span
								class="ruby-operator">|</span>
      <span class="ruby-identifier">arc_src</span> = <span
								class="ruby-identifier">archive_details</span>[<span
								class="ruby-value">:source_url</span>]
      <span class="ruby-identifier">arc_name</span> = <span
								class="ruby-identifier">archive_details</span>[<span
								class="ruby-value">:package_name</span>]
      <span class="ruby-identifier">arc_loc</span> = <span
								class="ruby-identifier">archive_details</span>[<span
								class="ruby-value">:destination</span>]
      <span class="ruby-identifier">arc_extract</span> = <span
								class="ruby-identifier">archive_details</span>[<span
								class="ruby-value">:extraction_command</span>]
      <span class="ruby-identifier">arc_dir</span> = <span
								class="ruby-identifier">archive_details</span>[<span
								class="ruby-value">:path_to_extracted</span>]
      <span class="ruby-comment">#          if(n &gt;0)</span>
      <span class="ruby-comment">#            archive_details[:source_url]=arc_src</span>
      <span class="ruby-comment">#            archive_details[:package_name]=arc_name</span>
      <span class="ruby-comment">#            archive_details[:extraction_cmd]=arc_extract</span>
      <span class="ruby-comment">#            archive_details[:destination]=arc_loc</span>
      <span class="ruby-comment">#            archive_details[:path_to_extracted]=arc_dir</span>
      <span class="ruby-comment">#            srcs = srcs + &quot; &quot;</span>
      <span class="ruby-comment">#            names =names + &quot; &quot;</span>
      <span class="ruby-comment">#            locations = locations + &quot; &quot;</span>
      <span class="ruby-comment">#            extracts =extracts + &quot; &quot;</span>
      <span class="ruby-comment">#            dirs =dirs + &quot; &quot;</span>
      <span class="ruby-comment">#          end</span>
      <span class="ruby-identifier">p</span> <span class="ruby-string">&quot;_+_+_+_+_+_+_+_+_+_+_&quot;</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">archive_details</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">arc_src</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;_&quot;</span> 
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">arc_name</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;_&quot;</span> 
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">arc_loc</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;_&quot;</span> 
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">arc_extract</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;_&quot;</span> 
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">arc_dir</span> <span
								class="ruby-operator">+</span><span class="ruby-string">&quot;|&quot;</span>
        
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">arc_loc</span> <span
								class="ruby-operator">==</span> <span class="ruby-string">&quot;./&quot;</span>
        <span class="ruby-identifier">arc_loc</span>=<span
								class="ruby-string">&quot;&quot;</span>
      <span class="ruby-keyword">elsif</span> <span
								class="ruby-identifier">arc_loc</span>.<span
								class="ruby-identifier">end_with?</span>(<span
								class="ruby-string">&quot;/&quot;</span>)
        <span class="ruby-identifier">arc_loc</span> = <span
								class="ruby-identifier">arc_loc</span>.<span
								class="ruby-identifier">chop</span>() <span class="ruby-comment">#note not String#chop</span>
      <span class="ruby-keyword">end</span>
      
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">arc_extract</span> <span
								class="ruby-operator">==</span> <span class="ruby-string">&quot;git&quot;</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;WORKDIR /tmp&quot;</span>)
        <span class="ruby-identifier">count_layer</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER $ContUser&quot;</span>)
        <span class="ruby-identifier">count_layer</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN git clone &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">arc_src</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; --depth 1 &quot;</span> )
        <span class="ruby-identifier">count_layer</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER 0  &quot;</span>)
        <span class="ruby-identifier">count_layer</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN mv  &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">arc_dir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; /home/app&quot;</span> <span
								class="ruby-operator">+</span>  <span class="ruby-identifier">arc_loc</span> )
        <span class="ruby-identifier">count_layer</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER $ContUser&quot;</span>)
        <span class="ruby-identifier">count_layer</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER $ContUser&quot;</span>)
        <span class="ruby-identifier">count_layer</span>
        <span class="ruby-identifier">step_back</span>=<span
								class="ruby-keyword">false</span>

        <span class="ruby-keyword">if</span> <span
								class="ruby-identifier">arc_dir</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> 
          <span class="ruby-identifier">step_back</span>=<span
								class="ruby-keyword">true</span>
          <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN   mkdir /tmp/app&quot;</span>)
          <span class="ruby-identifier">count_layer</span>
          <span class="ruby-identifier">arc_dir</span> = <span
								class="ruby-string">&quot;app&quot;</span>
          <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;WORKDIR /tmp/app&quot;</span>)
          <span class="ruby-identifier">count_layer</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;WORKDIR /tmp&quot;</span>)
          <span class="ruby-identifier">count_layer</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN   wget  -O \&quot;&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">arc_name</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot; \&quot;&quot;</span>  <span
								class="ruby-operator">+</span> <span class="ruby-identifier">arc_src</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot; ;\\&quot;</span> )
        <span class="ruby-keyword">if</span> <span
								class="ruby-identifier">arc_extract!</span>= <span
								class="ruby-keyword">nil</span>
          <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot; &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">arc_extract</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; \&quot;&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">arc_name</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot; ;\\&quot;</span>) <span
								class="ruby-comment"># + &quot;\&quot;* 2&gt;&amp;1 &gt; /dev/null &quot;)</span>
          <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot; rm \&quot;&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">arc_name</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot;&quot;</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;echo&quot;</span>) <span
								class="ruby-comment">#step past the next shell line implied by preceeding ;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER 0  &quot;</span>)
        <span class="ruby-identifier">count_layer</span>
        <span class="ruby-keyword">if</span> <span
								class="ruby-identifier">step_back</span><span
								class="ruby-operator">==</span><span class="ruby-keyword">true</span>
          <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;WORKDIR /tmp&quot;</span>)
          <span class="ruby-identifier">count_layer</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span>  <span
								class="ruby-identifier">arc_loc</span>.<span
								class="ruby-identifier">start_with?</span>(<span
								class="ruby-string">&quot;/home/app&quot;</span>) <span
								class="ruby-operator">||</span> <span class="ruby-identifier">arc_loc</span>.<span
								class="ruby-identifier">start_with?</span>(<span
								class="ruby-string">&quot;/home/local/&quot;</span>)
          <span class="ruby-identifier">dest_prefix</span>=<span
								class="ruby-string">&quot;&quot;</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">dest_prefix</span>=<span
								class="ruby-string">&quot;/home/app&quot;</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;run   if test ! -d &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">arc_dir</span>  <span
								class="ruby-operator">+</span><span class="ruby-string">&quot; ;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;       then\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot; mkdir -p /home/app ;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot; fi;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot; mv &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">arc_dir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">dest_prefix</span> <span
								class="ruby-operator">+</span>  <span class="ruby-identifier">arc_loc</span> )
        <span class="ruby-identifier">count_layer</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER $ContUser&quot;</span>)
        <span class="ruby-identifier">count_layer</span>

      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_clear_env_variables" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_clear_env_variables</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="write_clear_env_variables-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_clear_env_variables</span>
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Clear env&quot;</span>)
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">environments</span>.<span
								class="ruby-identifier">each</span>  <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">env</span><span
								class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">env</span>.<span
								class="ruby-identifier">build_time_only</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">env</span>.<span
								class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span
								class="ruby-string">&quot; .&quot;</span>)
      <span class="ruby-identifier">count_layer</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
  <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_container_user" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_container_user</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_container_user-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 667</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_container_user</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Container Data User&quot;</span>)
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Dockerfile:User&quot;</span>)

    <span class="ruby-comment">#FIXME needs to by dynamic</span>

    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV data_gid &quot;</span> <span
								class="ruby-operator">+</span>  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">data_uid</span>)
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV data_uid &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">data_gid</span>)
    <span class="ruby-identifier">count_layer</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_data_permissions" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_data_permissions</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_data_permissions-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 184</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_data_permissions</span>
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Data Permissions&quot;</span>)
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER 0&quot;</span>)
  <span class="ruby-identifier">count_layer</span>()
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN /usr/sbin/usermod -u $data_uid data-user;\\&quot;</span>)
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;chown -R $data_uid.$data_gid /home/app /home/fs ;\\&quot;</span>)
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;chmod -R 770 /home/fs&quot;</span>)
  <span class="ruby-identifier">count_layer</span>
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER $ContUser&quot;</span>)
  <span class="ruby-identifier">count_layer</span>

<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_environment_variables" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_environment_variables</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="write_environment_variables-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 126</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_environment_variables</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Environment Variables&quot;</span>)
    <span class="ruby-comment">#Fixme</span>
    <span class="ruby-comment">#kludge</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#System Envs&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV TZ Sydney/Australia&quot;</span>)
    <span class="ruby-identifier">count_layer</span>
    
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">environments</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">env</span><span
								class="ruby-operator">|</span>
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Blueprint ENVs&quot;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">env</span>.<span
								class="ruby-identifier">value</span> <span class="ruby-operator">&amp;&amp;</span> <span
								class="ruby-identifier">env</span>.<span class="ruby-identifier">value</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span
								class="ruby-operator">&amp;&amp;</span> <span
								class="ruby-identifier">env</span>.<span class="ruby-identifier">value</span>.<span
								class="ruby-identifier">to_s</span>.<span
								class="ruby-identifier">length</span> <span
								class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
        <span class="ruby-identifier">p</span> <span class="ruby-value">:env_val</span>
        <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">env</span>.<span class="ruby-identifier">value</span>
        <span class="ruby-identifier">env</span>.<span
								class="ruby-identifier">value</span> = <span
								class="ruby-identifier">env</span>.<span class="ruby-identifier">value</span>.<span
								class="ruby-identifier">sub</span>(<span class="ruby-regexp">/ /</span>,<span
								class="ruby-string">&quot;\\ &quot;</span>)
      <span class="ruby-keyword">end</span>
       <span class="ruby-keyword">if</span>  <span
								class="ruby-identifier">env</span>.<span class="ruby-identifier">value</span> <span
								class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span
								class="ruby-operator">&amp;&amp;</span> <span
								class="ruby-identifier">env</span>.<span class="ruby-identifier">value</span>.<span
								class="ruby-identifier">to_s</span>.<span
								class="ruby-identifier">length</span> <span
								class="ruby-operator">&gt;</span><span class="ruby-value">0</span> <span
								class="ruby-comment">#env statement must have two arguments</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">env</span>.<span
								class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span
								class="ruby-string">&quot; &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">env</span>.<span
								class="ruby-identifier">value</span>.<span
								class="ruby-identifier">to_s</span> )
        <span class="ruby-identifier">count_layer</span>
       <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_file_service" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_file_service</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_file_service-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 247</span>
  <span class="ruby-keyword">def</span>  <span class="ruby-identifier">write_file_service</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#File Service&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#FS Env&quot;</span>)
<span class="ruby-comment">#        @docker_file.puts(&quot;ENV CONTFSVolHome /home/fs/&quot; )</span>
<span class="ruby-comment">#        count_layer</span>
      <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">volumes</span>.<span
								class="ruby-identifier">each_value</span> <span
								class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span
								class="ruby-identifier">vol</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">dest</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span
								class="ruby-identifier">vol</span>.<span class="ruby-identifier">remotepath</span>)
<span class="ruby-comment">#          @docker_file.puts(&quot;ENV VOLDIR /home/fs/&quot; + dest)</span>
<span class="ruby-comment">#          count_layer</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN mkdir -p $CONTFSVolHome/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">dest</span>)
        <span class="ruby-identifier">count_layer</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
      <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
      <span class="ruby-keyword">return</span> <span
								class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_files_for_docker" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_files_for_docker</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_files_for_docker-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 32</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_files_for_docker</span>
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-identifier">write_environment_variables</span>
  <span class="ruby-identifier">write_stack_env</span>
 <span class="ruby-comment"># write_services</span>
  <span class="ruby-identifier">write_file_service</span>
  
  <span class="ruby-comment">#write_db_service</span>
  <span class="ruby-comment">#write_cron_jobs</span>
  <span class="ruby-identifier">write_os_packages</span>
  <span class="ruby-identifier">write_apache_modules</span>
  <span class="ruby-identifier">write_user_local</span> = <span
								class="ruby-keyword">true</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">write_user_local</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN ln -s /usr/local/ /home/local;\\&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;     chown -R $ContUser /usr/local/&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">write_app_archives</span>
  <span class="ruby-identifier">write_container_user</span>
  <span class="ruby-identifier">chown_home_app</span>
  <span class="ruby-identifier">write_worker_commands</span>            
  <span class="ruby-identifier">write_sed_strings</span>
  <span class="ruby-identifier">write_persistent_dirs</span>
  <span class="ruby-identifier">write_persistent_files</span>
  <span class="ruby-identifier">insert_framework_frag_in_dockerfile</span>(<span
								class="ruby-string">&quot;builder.mid.tmpl&quot;</span>)
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-identifier">write_rake_list</span>
  <span class="ruby-identifier">write_pear_list</span>
  <span class="ruby-identifier">write_apache_modules</span>    
  <span class="ruby-identifier">write_write_permissions_recursive</span> <span
								class="ruby-comment">#recursive firs (as can use to create blank dir)</span>
  <span class="ruby-identifier">write_write_permissions_single</span>

  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER 0&quot;</span>)
  <span class="ruby-identifier">count_layer</span>()
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;run mkdir -p /home/fs/local/&quot;</span>)
  <span class="ruby-identifier">count_layer</span>()
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)


  <span class="ruby-identifier">write_run_install_script</span>

  <span class="ruby-identifier">write_data_permissions</span>

  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER 0&quot;</span>)
  <span class="ruby-identifier">count_layer</span>()

  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;run mv /home/fs /home/fs_src&quot;</span>)
  <span class="ruby-identifier">count_layer</span>()
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;VOLUME /home/fs_src/&quot;</span>)
  <span class="ruby-identifier">count_layer</span>()
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER $ContUser&quot;</span>)
  <span class="ruby-identifier">count_layer</span>()
  <span class="ruby-identifier">insert_framework_frag_in_dockerfile</span>(<span
								class="ruby-string">&quot;builder.end.tmpl&quot;</span>)
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;VOLUME /home/fs/&quot;</span>)
  <span class="ruby-identifier">count_layer</span>()
 
  <span class="ruby-identifier">write_clear_env_variables</span>
  

  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">close</span>

<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_os_packages" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_os_packages</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_os_packages-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 348</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_os_packages</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">packages</span>=<span
								class="ruby-constant">String</span>.<span
								class="ruby-identifier">new</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#OS Packages&quot;</span>)
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">os_packages</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">package</span><span
								class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">package</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">packages</span> = <span
								class="ruby-identifier">packages</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">package</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">packages</span>.<span
								class="ruby-identifier">length</span> <span
								class="ruby-operator">&gt;</span><span class="ruby-value">1</span>
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;\nRUN apt-get install -y &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">packages</span> )
      <span class="ruby-identifier">count_layer</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment">#FIXME Wrong spot</span>
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">workerPorts</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">port</span><span
								class="ruby-operator">|</span>
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;EXPOSE &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">port</span>.<span
								class="ruby-identifier">port</span>.<span
								class="ruby-identifier">to_s</span>)
      <span class="ruby-identifier">count_layer</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_pear_list" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_pear_list</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_pear_list-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 727</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_pear_list</span>
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#OPear List&quot;</span>)
  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Dockerfile:Pear List&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">pear_modules</span>.<span
								class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span><span
								class="ruby-value">0</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN   wget http://pear.php.net/go-pear.phar;\\&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;  echo suhosin.executor.include.whitelist = phar &gt;&gt;/etc/php5/conf.d/suhosin.ini ;\\&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;  php go-pear.phar&quot;</span>)
    <span class="ruby-identifier">count_layer</span>

    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">pear_modules</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">pear_mod</span><span
								class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">pear_mod</span> <span
								class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN  pear install pear_mod &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">pear_mod</span> )
        <span class="ruby-identifier">count_layer</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
  <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_persistent_dirs" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_persistent_dirs</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_persistent_dirs-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 155</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_persistent_dirs</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;setup persistent Dirs&quot;</span>)

    <span class="ruby-identifier">n</span>=<span class="ruby-value">0</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Persistant Dirs&quot;</span>)
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">persistent_dirs</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">path</span><span
								class="ruby-operator">|</span>

      <span class="ruby-identifier">path</span>.<span
								class="ruby-identifier">chomp!</span>(<span class="ruby-string">&quot;/&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN  \\&quot;</span>)
      <span class="ruby-identifier">dirname</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span
								class="ruby-identifier">path</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;mkdir -p $CONTFSVolHome/$VOLDIR/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">dirname</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;;\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;if [ ! -d /home/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; ];\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;  then \\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;    mkdir -p /home/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span><span class="ruby-string">&quot; ;\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;  fi;\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;mv /home/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; $CONTFSVolHome/$VOLDIR/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">dirname</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/;\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ln -s $CONTFSVolHome/$VOLDIR/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; /home/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span>)
      <span class="ruby-identifier">n</span>=<span
								class="ruby-identifier">n</span><span class="ruby-operator">+</span><span
								class="ruby-value">1</span>
      <span class="ruby-identifier">count_layer</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_persistent_files" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_persistent_files</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_persistent_files-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 207</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_persistent_files</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Persistant Files&quot;</span>)
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;set setup_env&quot;</span>)
    <span class="ruby-identifier">src_paths</span> = <span
								class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">persistent_files</span>[<span
								class="ruby-value">:src_paths</span>]
    <span class="ruby-identifier">dest_paths</span> =  <span
								class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">persistent_files</span>[<span
								class="ruby-value">:dest_paths</span>]

    <span class="ruby-identifier">src_paths</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">path</span><span
								class="ruby-operator">|</span>
      <span class="ruby-comment">#          path = dest_paths[n]</span>
      <span class="ruby-identifier">p</span> <span class="ruby-value">:path</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">path</span>

      <span class="ruby-identifier">dir</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span
								class="ruby-identifier">path</span>)
      <span class="ruby-identifier">p</span> <span class="ruby-value">:dir</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">dir</span>
      <span class="ruby-keyword">if</span>  <span
								class="ruby-identifier">dir</span> <span class="ruby-operator">==</span> <span
								class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> <span
								class="ruby-identifier">dir</span>.<span class="ruby-identifier">length</span> <span
								class="ruby-operator">==</span><span class="ruby-value">0</span> <span
								class="ruby-operator">||</span> <span class="ruby-identifier">dir</span> <span
								class="ruby-operator">==</span><span class="ruby-string">&quot;.&quot;</span>
        <span class="ruby-identifier">dir</span> = <span
								class="ruby-string">&quot;app/&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">p</span> <span class="ruby-value">:dir</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">dir</span>
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN mkdir -p /home/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">dir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;;\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;  if [ ! -f /home/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; ];\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;    then \\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;      touch  /home/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span><span class="ruby-string">&quot;;\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;    fi;\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;  mkdir -p $CONTFSVolHome/$VOLDIR/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">dir</span> <span
								class="ruby-operator">+</span><span class="ruby-string">&quot;;\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;   mv /home/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; $CONTFSVolHome/$VOLDIR&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">dir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;;\\&quot;</span>)
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;    ln -s $CONTFSVolHome/$VOLDIR/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; /home/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span>)
      <span class="ruby-identifier">count_layer</span>

    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_rake_list" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_rake_list</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_rake_list-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 328</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_rake_list</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Rake Actions&quot;</span>)
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">rake_actions</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">rake_action</span><span
								class="ruby-operator">|</span>
      <span class="ruby-identifier">rake_cmd</span> = <span
								class="ruby-identifier">rake_action</span>[<span
								class="ruby-value">:action</span>]
       <span class="ruby-keyword">if</span> <span class="ruby-ivar">@builder</span>.<span
								class="ruby-identifier">first_build</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span> <span
								class="ruby-operator">&amp;&amp;</span>  <span
								class="ruby-identifier">rake_action</span>[<span
								class="ruby-value">:always_run</span>] <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
         <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">end</span>
      
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">rake_cmd</span> <span
								class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN  /usr/local/rbenv/shims/bundle exec rake &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">rake_cmd</span> )
        <span class="ruby-identifier">count_layer</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_run_install_script" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_run_install_script</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="write_run_install_script-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_run_install_script</span>
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;WorkDir /home/&quot;</span>)
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Setup templates and run installer&quot;</span>)
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;USER $ContUser&quot;</span>)
  <span class="ruby-identifier">count_layer</span>
  <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN bash /home/setup.sh&quot;</span>)
  <span class="ruby-identifier">count_layer</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_sed_strings" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_sed_strings</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">

					<p>def write_services</p>

					<pre class="ruby">
						<span class="ruby-identifier">services</span> = <span
							class="ruby-ivar">@blueprint_reader</span>.<span
							class="ruby-identifier">services</span>
<span class="ruby-ivar">@docker_file</span>.<span
							class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Service Environment Variables&quot;</span>)
  <span class="ruby-identifier">services</span>.<span
							class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
							class="ruby-operator">|</span><span class="ruby-identifier">service_hash</span><span
							class="ruby-operator">|</span>
    <span class="ruby-identifier">p</span> :<span
							class="ruby-identifier">service_hash</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">service_hash</span>
    <span class="ruby-identifier">service_def</span> =  <span
							class="ruby-ivar">@builder</span>.<span class="ruby-identifier">get_service_def</span>(<span
							class="ruby-identifier">service_hash</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_def</span> <span
							class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">p</span> :<span
							class="ruby-identifier">processing</span>
        <span class="ruby-identifier">p</span> <span
							class="ruby-identifier">service_def</span>

        <span class="ruby-identifier">service_environment_variables</span> = <span
							class="ruby-identifier">service_def</span>[:<span
							class="ruby-identifier">target_environment_variables</span>]
          <span class="ruby-keyword">if</span> <span
							class="ruby-identifier">service_environment_variables</span> <span
							class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
            <span class="ruby-identifier">service_environment_variables</span>.<span
							class="ruby-identifier">values</span>.<span
							class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
							class="ruby-operator">|</span><span class="ruby-identifier">env_variable_pair</span><span
							class="ruby-operator">|</span>
              <span class="ruby-identifier">p</span> :<span
							class="ruby-identifier">setting_values</span>
              <span class="ruby-identifier">p</span> <span
							class="ruby-identifier">env_variable_pair</span>
              <span class="ruby-identifier">env_name</span> = <span
							class="ruby-identifier">env_variable_pair</span>[:<span
							class="ruby-identifier">environment_name</span>]
              <span class="ruby-identifier">value_name</span> = <span
							class="ruby-identifier">env_variable_pair</span>[:<span
							class="ruby-identifier">variable_name</span>]
              <span class="ruby-identifier">value</span>=<span
							class="ruby-identifier">service_hash</span>[:<span
							class="ruby-identifier">variables</span>][<span
							class="ruby-identifier">value_name</span>.<span
							class="ruby-identifier">to_sym</span>] 
              <span class="ruby-identifier">p</span> :<span
							class="ruby-identifier">looking_for_</span>
              <span class="ruby-identifier">p</span> <span
							class="ruby-identifier">value_name</span>
              <span class="ruby-identifier">p</span> :<span
							class="ruby-identifier">as_symbol</span>
               <span class="ruby-identifier">p</span> <span
							class="ruby-identifier">value_name</span>.<span
							class="ruby-identifier">to_sym</span>
               <span class="ruby-identifier">p</span> :<span
							class="ruby-identifier">in_service_hash</span>
               <span class="ruby-identifier">p</span> <span
							class="ruby-identifier">service_hash</span>
               <span class="ruby-identifier">p</span> :<span
							class="ruby-identifier">and_found</span>
               <span class="ruby-identifier">p</span> <span
							class="ruby-identifier">value</span>

              <span class="ruby-keyword">if</span> <span
							class="ruby-identifier">value</span> <span class="ruby-operator">!=</span> <span
							class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span
							class="ruby-identifier">value</span>.<span
							class="ruby-identifier">to_s</span>.<span class="ruby-identifier">length</span> <span
							class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
                <span class="ruby-ivar">@docker_file</span>.<span
							class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV &quot;</span> <span
							class="ruby-operator">+</span> <span class="ruby-identifier">env_name</span> <span
							class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span
							class="ruby-operator">+</span> <span class="ruby-identifier">value</span> )
                <span class="ruby-identifier">count_layer</span>()
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
</pre>

					<p>end</p>




					<div class="method-source-code" id="write_sed_strings-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 306</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">write_sed_strings</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">n</span>=<span class="ruby-value">0</span>
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Sed Strings&quot;</span>)
      <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">sed_strings</span>[<span
								class="ruby-value">:src_file</span>].<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">src_file</span><span
								class="ruby-operator">|</span>
        <span class="ruby-comment">#src_file = @sed_strings[:src_file][n]</span>
        <span class="ruby-identifier">dest_file</span> = <span
								class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">sed_strings</span>[<span
								class="ruby-value">:dest_file</span>][<span
								class="ruby-identifier">n</span>]
        <span class="ruby-identifier">sed_str</span> =  <span
								class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">sed_strings</span>[<span
								class="ruby-value">:sed_str</span>][<span
								class="ruby-identifier">n</span>]
        <span class="ruby-identifier">tmp_file</span> =  <span
								class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">sed_strings</span>[<span
								class="ruby-value">:tmp_file</span>][<span
								class="ruby-identifier">n</span>]
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN cat &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">src_file</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; | sed \&quot;&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">sed_str</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot; &gt; &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">tmp_file</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; ;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;     cp &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">tmp_file</span>  <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">dest_file</span>)
        <span class="ruby-identifier">count_layer</span>
        <span class="ruby-identifier">n</span>=<span
								class="ruby-identifier">n</span><span class="ruby-operator">+</span><span
								class="ruby-value">1</span>
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
<span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
      <span class="ruby-keyword">return</span> <span
								class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_stack_env" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_stack_env</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_stack_env-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 685</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_stack_env</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Dockerfile:Stack Environment&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Stack Env&quot;</span>)
    <span class="ruby-comment"># stef = File.open(get_basedir + &quot;/home/stack.env&quot;,&quot;w&quot;)</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Stack Env&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV Memory &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">memory</span>.<span
								class="ruby-identifier">to_s</span>)
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV Hostname &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-ivar">@hostname</span>)
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV Domainname &quot;</span> <span
								class="ruby-operator">+</span>  <span class="ruby-ivar">@domain_name</span> )
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV fqdn &quot;</span> <span
								class="ruby-operator">+</span>  <span class="ruby-ivar">@hostname</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;.&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-ivar">@domain_name</span> )
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV FRAMEWORK &quot;</span> <span
								class="ruby-operator">+</span>   <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">framework</span>  )
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV RUNTIME &quot;</span>  <span
								class="ruby-operator">+</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">runtime</span>  )
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV PORT &quot;</span> <span
								class="ruby-operator">+</span>  <span class="ruby-ivar">@webPort</span>.<span
								class="ruby-identifier">to_s</span>  )
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-identifier">wports</span> = <span
								class="ruby-constant">String</span>.<span
								class="ruby-identifier">new</span>
    <span class="ruby-identifier">n</span>=<span class="ruby-value">0</span>
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">workerPorts</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">port</span><span
								class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">n</span> <span
								class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">wports</span> =<span
								class="ruby-identifier">wports</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;EXPOSE &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">port</span>.<span
								class="ruby-identifier">port</span>.<span
								class="ruby-identifier">to_s</span>)
      <span class="ruby-identifier">count_layer</span>
      <span class="ruby-identifier">wports</span> = <span
								class="ruby-identifier">wports</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">port</span>.<span
								class="ruby-identifier">port</span>.<span
								class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">n</span>=<span
								class="ruby-identifier">n</span><span class="ruby-operator">+</span><span
								class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">wports</span>.<span
								class="ruby-identifier">length</span> <span
								class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
      <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV WorkerPorts &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot;&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">wports</span> <span
								class="ruby-operator">+</span><span class="ruby-string">&quot;\&quot;&quot;</span>)
      <span class="ruby-identifier">count_layer</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_worker_commands" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_worker_commands</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_worker_commands-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 410</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_worker_commands</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Worker Commands&quot;</span>)
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Dockerfile:Worker Commands&quot;</span>)
    <span class="ruby-identifier">scripts_path</span> = <span
								class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">get_basedir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/home/engines/scripts/&quot;</span>

    <span class="ruby-keyword">if</span> <span class="ruby-constant">Dir</span>.<span
								class="ruby-identifier">exist?</span>(<span
								class="ruby-identifier">scripts_path</span>) <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-constant">FileUtils</span>.<span
								class="ruby-identifier">mkdir_p</span>(<span
								class="ruby-identifier">scripts_path</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">worker_commands</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span
								class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">worker_commands</span>.<span
								class="ruby-identifier">length</span> <span
								class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
      <span class="ruby-identifier">cmdf</span>= <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>( <span
								class="ruby-identifier">scripts_path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;pre-running.sh&quot;</span>,<span
								class="ruby-string">&quot;w&quot;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span
								class="ruby-identifier">cmdf</span>
        <span class="ruby-identifier">puts</span>(<span
								class="ruby-string">&quot;failed to open &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">scripts_path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;pre-running.sh&quot;</span>)
        <span class="ruby-identifier">exit</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">cmdf</span>.<span
								class="ruby-identifier">chmod</span>(<span class="ruby-value">0755</span>)
      <span class="ruby-identifier">cmdf</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#!/bin/bash&quot;</span>)
      <span class="ruby-identifier">cmdf</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;cd /home/app&quot;</span>)
      <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">worker_commands</span>.<span
								class="ruby-identifier">each</span>  <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">command</span><span
								class="ruby-operator">|</span>
        <span class="ruby-identifier">cmdf</span>.<span
								class="ruby-identifier">puts</span>(<span
								class="ruby-identifier">command</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">cmdf</span>.<span
								class="ruby-identifier">close</span>
      <span class="ruby-constant">File</span>.<span
								class="ruby-identifier">chmod</span>(<span class="ruby-value">0755</span>,<span
								class="ruby-identifier">scripts_path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;pre-running.sh&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_write_permissions_recursive"
				class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_write_permissions_recursive</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="write_write_permissions_recursive-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 512</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_write_permissions_recursive</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Write Permissions  Recursive&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Dockerfile:Write Permissions Recursive&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">recursive_chmods</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">recursive_chmods</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">directory</span><span
								class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">directory</span> <span
								class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN if [ -h  /home/app/&quot;</span>  <span
								class="ruby-operator">+</span> <span class="ruby-identifier">directory</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; ] ;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;    then \\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;    dest=`ls -la /home/app/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">directory</span> <span
								class="ruby-operator">+</span><span class="ruby-string">&quot; |cut -f2 -d\&quot;&gt;\&quot;`;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;    chmod -R gu+rw $dest;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;  elif [ ! -d /home/app/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">directory</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; ] ;\\&quot;</span> )
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;    then \\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;       mkdir  \&quot;/home/app/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">directory</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot;;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;       chmod -R gu+rw \&quot;/home/app/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">directory</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot;;\\&quot;</span> )
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;  else\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;   chmod -R gu+rw \&quot;/home/app/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">directory</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;\&quot;;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;     for dir in `find  /home/app/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">directory</span>  <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; -type d  `;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;       do\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;           adir=`echo $dir | sed \&quot;/ /s//_+_/\&quot; |grep -v _+_` ;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;            if test -n $adir;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;                then\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;                      dirs=\&quot;$dirs $adir\&quot;;\\&quot;</span>);
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;                fi;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;       done;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot; if test -n \&quot;$dirs\&quot; ;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;      then\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;      chmod gu+x $dirs  ;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;fi;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;fi&quot;</span>)

        <span class="ruby-identifier">count_layer</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
  <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_write_permissions_single"
				class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_write_permissions_single</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">

					<p>def write_db_service</p>

					<pre class="ruby">
						<span class="ruby-keyword">begin</span>
  <span class="ruby-ivar">@docker_file</span>.<span
							class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Database Service&quot;</span>)
  <span class="ruby-identifier">log_build_output</span>(<span
							class="ruby-string">&quot;Dockerfile:DB env&quot;</span>)
  <span class="ruby-ivar">@blueprint_reader</span>.<span
							class="ruby-identifier">databases</span>.<span
							class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
							class="ruby-operator">|</span><span class="ruby-identifier">db</span><span
							class="ruby-operator">|</span>
    <span class="ruby-ivar">@docker_file</span>.<span
							class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Database Env&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
							class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV dbname &quot;</span> <span
							class="ruby-operator">+</span> <span class="ruby-identifier">db</span>.<span
							class="ruby-identifier">name</span>)
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
							class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV dbhost &quot;</span> <span
							class="ruby-operator">+</span> <span class="ruby-identifier">db</span>.<span
							class="ruby-identifier">dbHost</span>)
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
							class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV dbuser &quot;</span> <span
							class="ruby-operator">+</span> <span class="ruby-identifier">db</span>.<span
							class="ruby-identifier">dbUser</span>)
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-ivar">@docker_file</span>.<span
							class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV dbpasswd &quot;</span> <span
							class="ruby-operator">+</span> <span class="ruby-identifier">db</span>.<span
							class="ruby-identifier">dbPass</span>)
    <span class="ruby-identifier">count_layer</span>
    <span class="ruby-identifier">flavor</span> = <span
							class="ruby-identifier">db</span>.<span class="ruby-identifier">flavor</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">flavor</span> <span
							class="ruby-operator">==</span> <span class="ruby-string">&quot;mysql&quot;</span>
      <span class="ruby-identifier">flavor</span> = <span
							class="ruby-string">&quot;mysql2&quot;</span>
    <span class="ruby-keyword">elsif</span> <span
							class="ruby-identifier">flavor</span> <span class="ruby-operator">==</span> <span
							class="ruby-string">&quot;pgsql&quot;</span>
      <span class="ruby-identifier">flavor</span> = <span
							class="ruby-string">&quot;postgresql&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@docker_file</span>.<span
							class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;ENV dbflavor &quot;</span> <span
							class="ruby-operator">+</span> <span class="ruby-identifier">flavor</span>)
    <span class="ruby-identifier">count_layer</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
							class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
  <span class="ruby-identifier">log_exception</span>(<span
							class="ruby-identifier">e</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span>
</pre>

					<p>end</p>




					<div class="method-source-code"
						id="write_write_permissions_single-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/DockerFileBuilder.rb, line 486</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_write_permissions_single</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
    <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#Write Permissions Non Recursive&quot;</span>)
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Dockerfile:Write Permissions Non Recursive&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">single_chmods</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">single_chmods</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">path</span><span
								class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;RUN if [ ! -f /home/app/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; ];\\&quot;</span> )
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;   then \\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;   mkdir -p  `dirname /home/app/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;`;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;   touch  /home/app/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;     fi;\\&quot;</span>)
        <span class="ruby-ivar">@docker_file</span>.<span
								class="ruby-identifier">puts</span>( <span class="ruby-string">&quot;  chmod  775 /home/app/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">path</span> )
        <span class="ruby-identifier">count_layer</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


		</section>

	</section>
	</main>


	<footer id="validator-badges" role="contentinfo">
		<p>
			<a href="http://validator.w3.org/check/referer">Validate</a>
		<p>
			Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
		<p>
			Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a>
			by <a href="http://deveiate.org">Michael Granger</a>.
	</footer>