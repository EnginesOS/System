<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class EngineBuilder - RDoc Documentation</title>

<link href="./fonts.css" rel="stylesheet">
<link href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/navigation.js"></script>
<script src="./js/search_index.js"></script>
<script src="./js/search.js"></script>
<script src="./js/searcher.js"></script>
<script src="./js/darkfish.js"></script>
<body id="top" role="document" class="class">
	<nav role="navigation">
		<div id="project-navigation">
			<div id="home-section" role="region" title="Quick navigation"
				class="nav-section">
				<h2>
					<a href="./index.html" rel="home">Home</a>
				</h2>

				<div id="table-of-contents-navigation">
					<a href="./table_of_contents.html#pages">Pages</a> <a
						href="./table_of_contents.html#classes">Classes</a> <a
						href="./table_of_contents.html#methods">Methods</a>
				</div>
			</div>

			<div id="search-section" role="search"
				class="project-section initially-hidden">
				<form action="#" method="get" accept-charset="utf-8">
					<div id="search-field-wrapper">
						<input id="search-field" role="combobox" aria-label="Search"
							aria-autocomplete="list" aria-controls="search-results"
							type="text" name="search" placeholder="Search" spellcheck="false"
							title="Type to search, Up and Down to navigate, Enter to load">
					</div>

					<ul id="search-results" aria-label="Search Results"
						aria-busy="false" aria-expanded="false" aria-atomic="false"
						class="initially-hidden"></ul>
				</form>
			</div>

		</div>



		<div id="class-metadata">

			<div id="parent-class-section" class="nav-section">
				<h3>Parent</h3>


				<p class="link">
					<a href="Object.html">Object</a>
			</div>



			<!-- Method Quickref -->
			<div id="method-list-section" class="nav-section">
				<h3>Methods</h3>

				<ul class="link-list" role="directory">

					<li><a href="#method-c-new">::new</a>
					<li><a href="#method-c-re_install_engine">::re_install_engine</a>
					<li><a href="#method-i-backup_lastbuild">#backup_lastbuild</a>
					<li><a href="#method-i-build_container">#build_container</a>
					<li><a href="#method-i-build_from_blue_print">#build_from_blue_print</a>
					<li><a href="#method-i-build_init">#build_init</a>
					<li><a href="#method-i-clone_repo">#clone_repo</a>
					<li><a href="#method-i-close_all">#close_all</a>
					<li><a href="#method-i-compile_base_docker_files">#compile_base_docker_files</a>
					<li><a href="#method-i-create_apache_config">#create_apache_config</a>
					<li><a href="#method-i-create_httaccess">#create_httaccess</a>
					<li><a href="#method-i-create_install_script">#create_install_script</a>
					<li><a href="#method-i-create_managed_container">#create_managed_container</a>
					<li><a href="#method-i-create_non_persistent_services">#create_non_persistent_services</a>
					<li><a href="#method-i-create_persistent_services">#create_persistent_services</a>
					<li><a href="#method-i-create_php_ini">#create_php_ini</a>
					<li><a href="#method-i-create_post_install_script">#create_post_install_script</a>
					<li><a href="#method-i-create_scritps">#create_scritps</a>
					<li><a href="#method-i-create_start_script">#create_start_script</a>
					<li><a href="#method-i-create_template_files">#create_template_files</a>
					<li><a href="#method-i-debug">#debug</a>
					<li><a href="#method-i-evaluate_function">#evaluate_function</a>
					<li><a href="#method-i-fill_in_dynamic_vars">#fill_in_dynamic_vars</a>
					<li><a href="#method-i-fill_service_environment_variables">#fill_service_environment_variables</a>
					<li><a href="#method-i-get_basedir">#get_basedir</a>
					<li><a href="#method-i-get_blueprint_from_repo">#get_blueprint_from_repo</a>
					<li><a href="#method-i-get_build_err_stream">#get_build_err_stream</a>
					<li><a href="#method-i-get_build_log_stream">#get_build_log_stream</a>
					<li><a href="#method-i-get_service_def">#get_service_def</a>
					<li><a href="#method-i-launch_deploy">#launch_deploy</a>
					<li><a href="#method-i-load_blueprint">#load_blueprint</a>
					<li><a href="#method-i-log_build_errors">#log_build_errors</a>
					<li><a href="#method-i-log_build_output">#log_build_output</a>
					<li><a href="#method-i-post_failed_build_clean_up">#post_failed_build_clean_up</a>
					<li><a href="#method-i-process_dockerfile_tmpl">#process_dockerfile_tmpl</a>
					<li><a href="#method-i-read_web_port">#read_web_port</a>
					<li><a href="#method-i-read_web_user">#read_web_user</a>
					<li><a href="#method-i-reattach_service">#reattach_service</a>
					<li><a href="#method-i-rebuild_managed_container">#rebuild_managed_container</a>
					<li><a href="#method-i-release_orphan">#release_orphan</a>
					<li><a href="#method-i-run_system">#run_system</a>
					<li><a href="#method-i-set_top_level_service_params">#set_top_level_service_params</a>
					<li><a href="#method-i-setup_default_files">#setup_default_files</a>
					<li><a href="#method-i-setup_framework_defaults">#setup_framework_defaults</a>
					<li><a href="#method-i-setup_framework_logging">#setup_framework_logging</a>
					<li><a href="#method-i-setup_global_defaults">#setup_global_defaults</a>
					<li><a href="#method-i-setup_rebuild">#setup_rebuild</a>
					<li><a href="#method-i-tail_of_build_log">#tail_of_build_log</a>
					<li><a href="#method-i-write_software_file">#write_software_file</a>
				</ul>
			</div>

		</div>
	</nav>

	<main role="main" aria-labelledby="class-EngineBuilder">
	<h1 id="class-EngineBuilder" class="class">class EngineBuilder</h1>

	<section class="description"></section>




	<section id="5Buntitled-5D" class="documentation-section">







		<section class="attribute-method-details" class="method-section">
			<header>
				<h3>Attributes</h3>
			</header>


			<div id="attribute-i-blueprint" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">blueprint</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-build_name" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">build_name</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-container_name" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">container_name</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-domain_name" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">domain_name</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-environments" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">environments</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-first_build" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">first_build</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-hostname" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">hostname</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-http_protocol" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">http_protocol</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-last_error" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">last_error</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-repoName" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">repoName</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-runtime" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">runtime</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-set_environments" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">set_environments</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

			<div id="attribute-i-webPort" class="method-detail">
				<div class="method-heading attribute-method-heading">
					<span class="method-name">webPort</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description"></div>
			</div>

		</section>



		<section id="public-class-5Buntitled-5D-method-details"
			class="method-section">
			<header>
				<h3>Public Class Methods</h3>
			</header>


			<div id="method-c-new" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">new</span><span class="method-args">(params,core_api)</span>

					<span class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="new-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 50</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span
								class="ruby-identifier">params</span>,<span
								class="ruby-identifier">core_api</span>)
  <span class="ruby-ivar">@container_name</span> = <span
								class="ruby-identifier">params</span>[<span class="ruby-value">:engine_name</span>]
  <span class="ruby-ivar">@domain_name</span> = <span
								class="ruby-identifier">params</span>[<span class="ruby-value">:domain_name</span>]
  <span class="ruby-ivar">@hostname</span> = <span
								class="ruby-identifier">params</span>[<span class="ruby-value">:host_name</span>]
  <span class="ruby-identifier">custom_env</span>= <span
								class="ruby-identifier">params</span>[<span class="ruby-value">:software_environment_variables</span>]
  <span class="ruby-comment">#   custom_env=params</span>
  <span class="ruby-ivar">@core_api</span> = <span
								class="ruby-identifier">core_api</span>
  <span class="ruby-ivar">@http_protocol</span> = <span
								class="ruby-identifier">params</span>[<span class="ruby-value">:http_protocol</span>]
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">params</span>
  <span class="ruby-ivar">@memory</span> = <span class="ruby-identifier">params</span>[<span
								class="ruby-value">:memory</span>]
  <span class="ruby-ivar">@repoName</span>= <span
								class="ruby-identifier">params</span>[<span class="ruby-value">:repository_url</span>]
  <span class="ruby-ivar">@cron_job_list</span> = <span
								class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@build_name</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span
								class="ruby-ivar">@repoName</span>).<span
								class="ruby-identifier">sub</span>(<span class="ruby-regexp">/\.git$/</span>,<span
								class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-ivar">@workerPorts</span>=<span
								class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@webPort</span>=<span class="ruby-value">8000</span>
  <span class="ruby-ivar">@vols</span>=<span class="ruby-constant">Array</span>.<span
								class="ruby-identifier">new</span>
  <span class="ruby-ivar">@first_build</span> = <span
								class="ruby-keyword">true</span>

  <span class="ruby-ivar">@attached_services</span> = <span
								class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-ivar">@builder_public</span> = <span
								class="ruby-constant">BuilderPublic</span>.<span
								class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-ivar">@system_access</span> = <span
								class="ruby-constant">SystemAccess</span>.<span
								class="ruby-identifier">new</span>()
  <span class="ruby-identifier">p</span> <span class="ruby-value">:custom_env</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">custom_env</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">custom_env</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@set_environments</span> = <span
								class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-ivar">@environments</span> = <span
								class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">elsif</span>  <span class="ruby-identifier">custom_env</span>.<span
								class="ruby-identifier">instance_of?</span>(<span
								class="ruby-constant">Array</span>) <span class="ruby-operator">==</span> <span
								class="ruby-keyword">true</span>
    <span class="ruby-ivar">@environments</span> = <span
								class="ruby-identifier">custom_env</span> <span
								class="ruby-comment"># happens on rebuild as custom env is saved in env on disk</span>
    <span class="ruby-comment">#FIXME need to vet all environment variables</span>
    <span class="ruby-ivar">@set_environments</span> = <span
								class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#      env_array = custom_env.fall</span>
    <span class="ruby-identifier">custom_env_hash</span> = <span
								class="ruby-identifier">custom_env</span>
    <span class="ruby-comment">#      env_array.each do |env_hash|</span>
    <span class="ruby-comment">#        p :env_hash</span>
    <span class="ruby-comment">#        p env_hash</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment">#        if env_hash != nil &amp;&amp; env_hash[:name] !=nil &amp;&amp; env_hash[:value] != nil</span>
    <span class="ruby-comment">#          env_hash[:name] = env_hash[:name].sub(/_/,&quot;&quot;)</span>
    <span class="ruby-comment">#          custom_env_hash.store(env_hash[:name],env_hash[:value])</span>
    <span class="ruby-comment">#        end</span>
    <span class="ruby-comment">#      end</span>
    <span class="ruby-identifier">p</span> <span class="ruby-value">:Merged_custom_env</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">custom_env_hash</span>
    <span class="ruby-ivar">@set_environments</span> =  <span
								class="ruby-identifier">custom_env_hash</span>
    <span class="ruby-ivar">@environments</span> = <span
								class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@runtime</span>=<span class="ruby-constant">String</span>.<span
								class="ruby-identifier">new</span>
  <span class="ruby-ivar">@databases</span>= <span class="ruby-constant">Array</span>.<span
								class="ruby-identifier">new</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">FileUtils</span>.<span
								class="ruby-identifier">mkdir_p</span>(<span
								class="ruby-identifier">get_basedir</span>)
    <span class="ruby-ivar">@log_file</span>=  <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span
								class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">DeploymentDir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/build.out&quot;</span>, <span
								class="ruby-constant">File</span><span class="ruby-operator">::</span><span
								class="ruby-constant">CREAT</span><span class="ruby-operator">|</span><span
								class="ruby-constant">File</span><span class="ruby-operator">::</span><span
								class="ruby-constant">TRUNC</span><span class="ruby-operator">|</span><span
								class="ruby-constant">File</span><span class="ruby-operator">::</span><span
								class="ruby-constant">RDWR</span>, <span class="ruby-value">0644</span>)
    <span class="ruby-ivar">@err_file</span>=  <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span
								class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">DeploymentDir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/build.err&quot;</span>, <span
								class="ruby-constant">File</span><span class="ruby-operator">::</span><span
								class="ruby-constant">CREAT</span><span class="ruby-operator">|</span><span
								class="ruby-constant">File</span><span class="ruby-operator">::</span><span
								class="ruby-constant">TRUNC</span><span class="ruby-operator">|</span><span
								class="ruby-constant">File</span><span class="ruby-operator">::</span><span
								class="ruby-constant">RDWR</span>, <span class="ruby-value">0644</span>)
    <span class="ruby-ivar">@log_pipe_rd</span>, <span class="ruby-ivar">@log_pipe_wr</span> = <span
								class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
    <span class="ruby-ivar">@error_pipe_rd</span>, <span
								class="ruby-ivar">@error_pipe_wr</span> = <span
								class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-keyword">rescue</span>
    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-c-re_install_engine" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">re_install_engine</span><span
						class="method-args">(engine,core)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="re_install_engine-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 828</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">EngineBuilder</span>.<span
								class="ruby-identifier">re_install_engine</span>(<span
								class="ruby-identifier">engine</span>,<span
								class="ruby-identifier">core</span>)
  <span class="ruby-identifier">params</span> = <span
								class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">params</span>[<span class="ruby-value">:engine_name</span>] = <span
								class="ruby-identifier">engine</span>.<span
								class="ruby-identifier">containerName</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:domain_name</span>] = <span
								class="ruby-identifier">engine</span>.<span
								class="ruby-identifier">domainName</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:host_name</span>] = <span
								class="ruby-identifier">engine</span>.<span
								class="ruby-identifier">hostName</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:software_environment_variables</span>] = <span
								class="ruby-identifier">engine</span>.<span
								class="ruby-identifier">environments</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:http_protocol</span>] = <span
								class="ruby-identifier">engine</span>.<span
								class="ruby-identifier">protocol</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:memory</span>] = <span
								class="ruby-identifier">engine</span>.<span
								class="ruby-identifier">memory</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:repository_url</span>]  = <span
								class="ruby-identifier">engine</span>.<span
								class="ruby-identifier">repo</span>

  <span class="ruby-identifier">builder</span> = <span
								class="ruby-constant">EngineBuilder</span>.<span
								class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>,<span
								class="ruby-identifier">core</span>)
  <span class="ruby-identifier">engine</span> = <span
								class="ruby-identifier">builder</span>.<span
								class="ruby-identifier">build_from_blue_print</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">engine</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">return</span>  <span
								class="ruby-identifier">failed</span>(<span
								class="ruby-identifier">params</span>[<span class="ruby-value">:engine_name</span>],<span
								class="ruby-identifier">builder</span>.<span
								class="ruby-identifier">last_error</span>,<span
								class="ruby-string">&quot;build_engine&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">engine</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">engine</span>.<span
								class="ruby-identifier">is_active</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">failed</span>(<span
								class="ruby-identifier">params</span>[<span class="ruby-value">:engine_name</span>],<span
								class="ruby-string">&quot;Failed to start  &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">last_api_error</span> ,<span
								class="ruby-string">&quot;Reinstall Engine&quot;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">engine</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">failed</span>(<span
								class="ruby-identifier">host_name</span>,<span
								class="ruby-identifier">last_api_error</span>,<span
								class="ruby-string">&quot;build_engine&quot;</span>)

<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">log_exception_and_fail</span>(<span
								class="ruby-string">&quot;build_engine&quot;</span>,<span
								class="ruby-identifier">e</span>)
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


		</section>

		<section id="public-instance-5Buntitled-5D-method-details"
			class="method-section">
			<header>
				<h3>Public Instance Methods</h3>
			</header>


			<div id="method-i-backup_lastbuild" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">backup_lastbuild</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="backup_lastbuild-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">backup_lastbuild</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">dir</span>=<span
								class="ruby-identifier">get_basedir</span>

    <span class="ruby-keyword">if</span> <span class="ruby-constant">Dir</span>.<span
								class="ruby-identifier">exist?</span>(<span
								class="ruby-identifier">dir</span>)
      <span class="ruby-identifier">backup</span>=<span
								class="ruby-identifier">dir</span> <span class="ruby-operator">+</span> <span
								class="ruby-string">&quot;.backup&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-constant">Dir</span>.<span
								class="ruby-identifier">exist?</span>(<span
								class="ruby-identifier">backup</span>)
        <span class="ruby-constant">FileUtils</span>.<span
								class="ruby-identifier">rm_rf</span> <span
								class="ruby-identifier">backup</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">FileUtils</span>.<span
								class="ruby-identifier">mv</span>(<span class="ruby-identifier">dir</span>,<span
								class="ruby-identifier">backup</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
    <span class="ruby-comment">#throw BuildException.new(e,&quot;backup_lastbuild&quot;)</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-build_container" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">build_container</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="build_container-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 399</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_container</span>
  <span class="ruby-keyword">begin</span>

    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Reading Blueprint&quot;</span>)
    <span class="ruby-ivar">@blueprint</span> = <span
								class="ruby-identifier">load_blueprint</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint</span> <span
								class="ruby-operator">==</span>  <span class="ruby-keyword">nil</span> <span
								class="ruby-operator">||</span>  <span class="ruby-ivar">@blueprint</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">close_all</span>
      <span class="ruby-keyword">return</span> <span
								class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@blueprint_reader</span> = <span
								class="ruby-constant">BluePrintReader</span>.<span
								class="ruby-identifier">new</span>(<span class="ruby-ivar">@build_name</span>,<span
								class="ruby-ivar">@container_name</span>,<span class="ruby-ivar">@blueprint</span>,<span
								class="ruby-keyword">self</span>)
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">process_blueprint</span>

    <span class="ruby-keyword">if</span>  <span class="ruby-identifier">setup_default_files</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">close_all</span>
      <span class="ruby-keyword">return</span> <span
								class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">compile_base_docker_files</span>

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">web_port</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-ivar">@webPort</span> = <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">web_port</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">read_web_port</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">read_web_user</span>

    <span class="ruby-identifier">create_persistent_services</span>

    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">environments</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">env</span><span
								class="ruby-operator">|</span>
      <span class="ruby-identifier">p</span> <span class="ruby-value">:env_before</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">env</span>.<span class="ruby-identifier">value</span>
      <span class="ruby-identifier">env</span>.<span
								class="ruby-identifier">value</span>= <span
								class="ruby-identifier">process_templated_string</span>(<span
								class="ruby-identifier">env</span>.<span class="ruby-identifier">value</span>)
      <span class="ruby-identifier">p</span> <span class="ruby-value">:env_after</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">env</span>.<span class="ruby-identifier">value</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">fill_service_environment_variables</span>
    <span class="ruby-identifier">create_template_files</span>
    <span class="ruby-identifier">create_php_ini</span>
    <span class="ruby-identifier">create_apache_config</span>
    <span class="ruby-identifier">create_scritps</span>

    <span class="ruby-identifier">index</span>=<span class="ruby-value">0</span>
    <span class="ruby-comment">#FIXME There has to be a ruby way</span>
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">sed_strings</span>[<span
								class="ruby-value">:sed_str</span>].<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">sed_string</span><span
								class="ruby-operator">|</span>
      <span class="ruby-identifier">sed_string</span> = <span
								class="ruby-identifier">process_templated_string</span>(<span
								class="ruby-identifier">sed_string</span>)
      <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">sed_strings</span>[<span
								class="ruby-value">:sed_str</span>][<span
								class="ruby-identifier">index</span>] = <span
								class="ruby-identifier">sed_string</span>
      <span class="ruby-identifier">index</span><span
								class="ruby-operator">+=</span><span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">dockerfile_builder</span> = <span
								class="ruby-constant">DockerFileBuilder</span>.<span
								class="ruby-identifier">new</span>( <span class="ruby-ivar">@blueprint_reader</span>,<span
								class="ruby-ivar">@container_name</span>, <span
								class="ruby-ivar">@hostname</span>,<span class="ruby-ivar">@domain_name</span>,<span
								class="ruby-ivar">@webPort</span>,<span class="ruby-keyword">self</span>)
    <span class="ruby-identifier">dockerfile_builder</span>.<span
								class="ruby-identifier">write_files_for_docker</span>

    <span class="ruby-identifier">env_file</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span
								class="ruby-identifier">get_basedir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/home/app.env&quot;</span>,<span
								class="ruby-string">&quot;a&quot;</span>)
    <span class="ruby-identifier">env_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
    <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">environments</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">env</span><span
								class="ruby-operator">|</span>
      <span class="ruby-identifier">env_file</span>.<span
								class="ruby-identifier">puts</span>(<span
								class="ruby-identifier">env</span>.<span class="ruby-identifier">name</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@set_environments</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">env</span><span
								class="ruby-operator">|</span>
      <span class="ruby-identifier">env_file</span>.<span
								class="ruby-identifier">puts</span>(<span
								class="ruby-identifier">env</span>[<span class="ruby-value">0</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">env_file</span>.<span
								class="ruby-identifier">close</span>

    <span class="ruby-identifier">setup_framework_logging</span>

    <span class="ruby-comment">#      log_build_output(&quot;Creating db Services&quot;)</span>
    <span class="ruby-comment">#      @blueprint_reader.databases.each() do |db|</span>
    <span class="ruby-comment">#        create_database_service db</span>
    <span class="ruby-comment">#      end</span>

    <span class="ruby-keyword">if</span>  <span class="ruby-identifier">build_init</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-string">&quot;Error Build Image failed&quot;</span>)
      <span class="ruby-ivar">@last_error</span> =  <span
								class="ruby-string">&quot; &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">tail_of_build_log</span>
      <span class="ruby-identifier">post_failed_build_clean_up</span>
      <span class="ruby-keyword">return</span> <span
								class="ruby-keyword">false</span>
    <span class="ruby-keyword">else</span>

      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@core_api</span>.<span
								class="ruby-identifier">image_exists?</span>(<span
								class="ruby-ivar">@container_name</span>) <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
        <span class="ruby-identifier">p</span> <span class="ruby-value">:image_not_found</span>
        <span class="ruby-ivar">@last_error</span> = <span
								class="ruby-string">&quot; &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">tail_of_build_log</span>
        <span class="ruby-identifier">post_failed_build_clean_up</span>
        <span class="ruby-keyword">return</span> <span
								class="ruby-keyword">false</span>
        <span class="ruby-comment">#return EnginesOSapiResult.failed(@container_name,&quot;Build Image failed&quot;,&quot;build Image&quot;)</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#needs to be moved to services dependant on the new BPDS</span>
      <span class="ruby-comment">#create_cron_service</span>

      <span class="ruby-comment">#        log_build_output(&quot;Creating vol Services&quot;)</span>
      <span class="ruby-comment">#        @blueprint_reader.databases.each() do |db|</span>
      <span class="ruby-comment">#          create_database_service db</span>
      <span class="ruby-comment">#        end</span>
      <span class="ruby-comment">#</span>
      <span class="ruby-comment">#        primary_vol=nil</span>
      <span class="ruby-comment">#        @blueprint_reader.volumes.each_value() do |vol|</span>
      <span class="ruby-comment">#          create_file_service vol</span>
      <span class="ruby-comment">#          if primary_vol == nil</span>
      <span class="ruby-comment">#            primary_vol =vol</span>
      <span class="ruby-comment">#          end</span>
      <span class="ruby-comment">#        end</span>
      <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Creating Deploy Image&quot;</span>)
      <span class="ruby-identifier">mc</span> = <span
								class="ruby-identifier">create_managed_container</span>()
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">mc</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">create_non_persistent_services</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Build Successful&quot;</span>)
    <span class="ruby-identifier">build_report</span> = <span
								class="ruby-identifier">generate_build_report</span>(<span
								class="ruby-ivar">@blueprint</span>)
    <span class="ruby-ivar">@core_api</span>.<span
								class="ruby-identifier">save_build_report</span>(<span
								class="ruby-identifier">mc</span>,<span class="ruby-identifier">build_report</span>)
    <span class="ruby-identifier">p</span> <span class="ruby-value">:build_report</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">build_report</span>
    <span class="ruby-identifier">close_all</span>

    <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">mc</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>

    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-identifier">post_failed_build_clean_up</span>
    <span class="ruby-identifier">close_all</span>
    <span class="ruby-identifier">failed_report</span> = <span
								class="ruby-identifier">generate_build_report</span>(<span
								class="ruby-ivar">@blueprint</span>)
    <span class="ruby-identifier">p</span> <span class="ruby-value">:failed_report</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">failed_report</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-build_from_blue_print" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">build_from_blue_print</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="build_from_blue_print-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 355</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_from_blue_print</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">get_blueprint_from_repo</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">build_container</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-build_init" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">build_init</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">

					<p>def create_db_service(name,flavor)</p>

					<pre class="ruby">
						<span class="ruby-keyword">begin</span>
  <span class="ruby-identifier">log_build_output</span>(<span
							class="ruby-string">&quot;Create DB Service&quot;</span>)
  <span class="ruby-identifier">db</span> = <span class="ruby-constant">DatabaseService</span>.<span
							class="ruby-identifier">new</span>(<span class="ruby-ivar">@hostname</span>,<span
							class="ruby-identifier">name</span>,<span class="ruby-constant">SysConfig</span>.<span
							class="ruby-constant">DBHost</span>,<span class="ruby-identifier">name</span>,<span
							class="ruby-identifier">name</span>,<span class="ruby-identifier">flavor</span>)
  <span class="ruby-identifier">databases</span>.<span
							class="ruby-identifier">push</span>(<span class="ruby-identifier">db</span>)
  <span class="ruby-identifier">create_database_service</span> <span
							class="ruby-identifier">db</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
							class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
  <span class="ruby-identifier">log_exception</span>(<span
							class="ruby-identifier">e</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span>
</pre>

					<p>end</p>




					<div class="method-source-code" id="build_init-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 283</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_init</span>

  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Building Image&quot;</span>)
  <span class="ruby-comment"># cmd=&quot;cd &quot; + get_basedir + &quot;; docker build  -t &quot; + @hostname + &quot;/init .&quot;</span>
  <span class="ruby-identifier">cmd</span>=<span class="ruby-string">&quot;/usr/bin/docker build  --tag=&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-ivar">@container_name</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span
								class="ruby-operator">+</span>  <span class="ruby-identifier">get_basedir</span>

  <span class="ruby-identifier">puts</span> <span
								class="ruby-identifier">cmd</span>

  <span class="ruby-identifier">res</span> = <span
								class="ruby-identifier">run_system</span>(<span
								class="ruby-identifier">cmd</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>  <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;build init failed &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">res</span>.<span
								class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-string">&quot;build init failed &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">res</span>)
    <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">res</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>

<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
  <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-clone_repo" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">clone_repo</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="clone_repo-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 222</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clone_repo</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Clone Blueprint Repository&quot;</span>)
    <span class="ruby-identifier">g</span> = <span class="ruby-constant">Git</span>.<span
								class="ruby-identifier">clone</span>(<span class="ruby-ivar">@repoName</span>, <span
								class="ruby-ivar">@build_name</span>, <span class="ruby-value">:path</span> =<span
								class="ruby-operator">&gt;</span> <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">DeploymentDir</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-close_all" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">close_all</span><span class="method-args">()</span>

					<span class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="close_all-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 113</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">close_all</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@log_file</span>.<span
								class="ruby-identifier">closed?</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Build Finished&quot;</span>)
    <span class="ruby-ivar">@log_file</span>.<span
								class="ruby-identifier">close</span>()
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span><span class="ruby-ivar">@err_file</span>.<span
								class="ruby-identifier">closed?</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-ivar">@err_file</span>.<span
								class="ruby-identifier">close</span>()
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@log_pipe_wr</span>.<span
								class="ruby-identifier">closed?</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-ivar">@log_pipe_wr</span>.<span
								class="ruby-identifier">close</span>()
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@error_pipe_wr</span>.<span
								class="ruby-identifier">closed?</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-ivar">@error_pipe_wr</span>.<span
								class="ruby-identifier">close</span>()
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-compile_base_docker_files" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">compile_base_docker_files</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="compile_base_docker_files-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 651</span>
<span class="ruby-keyword">def</span>  <span class="ruby-identifier">compile_base_docker_files</span>

  <span class="ruby-identifier">file_list</span> = <span
								class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span
								class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">get_basedir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/Dockerfile*.tmpl&quot;</span>)
  <span class="ruby-identifier">file_list</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">file</span><span
								class="ruby-operator">|</span>
    <span class="ruby-identifier">process_dockerfile_tmpl</span>(<span
								class="ruby-identifier">file</span>)
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_apache_config" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_apache_config</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="create_apache_config-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 606</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_apache_config</span>
  <span class="ruby-constant">FileUtils</span>.<span
								class="ruby-identifier">mkdir_p</span>(<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-constant">File</span>.<span
								class="ruby-identifier">dirname</span>(<span
								class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">CustomApacheConfFile</span>))
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>].<span
								class="ruby-identifier">has_key?</span>(<span class="ruby-value">:custom_apache_conf</span>) <span
								class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>][<span class="ruby-value">:custom_apache_conf</span>]  <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">write_software_file</span>(<span
								class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">CustomApacheConfFile</span>,<span
								class="ruby-ivar">@blueprint</span>[<span class="ruby-value">:software</span>][<span
								class="ruby-value">:custom_apache_conf</span>])

  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_httaccess" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_httaccess</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="create_httaccess-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 550</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_httaccess</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>].<span
								class="ruby-identifier">has_key?</span>(<span class="ruby-value">:apache_htaccess_files</span>) <span
								class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>][<span class="ruby-value">:apache_htaccess_files</span>]  <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@blueprint</span>[<span class="ruby-value">:software</span>][<span
								class="ruby-value">:apache_htaccess_files</span>].<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">htaccess_hash</span><span
								class="ruby-operator">|</span>
      <span class="ruby-identifier">write_software_file</span>(<span
								class="ruby-string">&quot;/home/engines/htaccess_files&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">template_hash</span>[<span
								class="ruby-value">:directory</span>]<span class="ruby-operator">+</span><span
								class="ruby-string">&quot;/.htaccess&quot;</span>,<span
								class="ruby-identifier">template_hash</span>[<span
								class="ruby-value">:htaccess_content</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_install_script" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_install_script</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="create_install_script-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 575</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_install_script</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>].<span
								class="ruby-identifier">has_key?</span>(<span class="ruby-value">:custom_install_script</span>) <span
								class="ruby-operator">&amp;&amp;</span>  <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>][<span class="ruby-value">:custom_install_script</span>] <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">install_script_file</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">InstallScript</span>,<span
								class="ruby-string">&quot;w&quot;</span>, <span
								class="ruby-value">:crlf_newline</span> =<span
								class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">install_script_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>][<span class="ruby-value">:custom_install_script</span>])
    <span class="ruby-identifier">install_script_file</span>.<span
								class="ruby-identifier">close</span>
    <span class="ruby-constant">File</span>.<span
								class="ruby-identifier">chmod</span>(<span class="ruby-value">0755</span>,<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">InstallScript</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_managed_container" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_managed_container</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="create_managed_container-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 883</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_managed_container</span>
  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Creating ManagedEngine&quot;</span>)
  <span class="ruby-identifier">mc</span> = <span class="ruby-constant">ManagedEngine</span>.<span
								class="ruby-identifier">new</span>(<span class="ruby-ivar">@container_name</span> ,
  <span class="ruby-ivar">@memory</span> ,
  <span class="ruby-ivar">@hostname</span>,
  <span class="ruby-ivar">@domain_name</span>,
  <span class="ruby-ivar">@container_name</span> ,
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">volumes</span>,
  <span class="ruby-ivar">@webPort</span>,
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">workerPorts</span>,
  <span class="ruby-ivar">@repoName</span>,
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">databases</span>,
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">environments</span>,
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">framework</span>,
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">runtime</span>,
  <span class="ruby-ivar">@core_api</span>,
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">data_uid</span>,
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">data_gid</span>
  )

  <span class="ruby-identifier">p</span> <span class="ruby-value">:set_cron_job_list</span>
  <span class="ruby-identifier">p</span> <span class="ruby-ivar">@cron_job_list</span>
  <span class="ruby-identifier">mc</span>.<span class="ruby-identifier">set_cron_job_list</span>(<span
								class="ruby-ivar">@cron_job_list</span>)
  <span class="ruby-comment">#:http_protocol=&gt;&quot;HTTPS and HTTP&quot;</span>
  <span class="ruby-identifier">mc</span>.<span class="ruby-identifier">set_protocol</span>(<span
								class="ruby-ivar">@protocol</span>)
  <span class="ruby-identifier">mc</span>.<span class="ruby-identifier">conf_register_site</span>=( <span
								class="ruby-keyword">true</span>) <span class="ruby-comment"># needs some intelligence here for worker only</span>
  <span class="ruby-identifier">mc</span>.<span class="ruby-identifier">conf_self_start</span>= (<span
								class="ruby-keyword">true</span>)
  <span class="ruby-identifier">mc</span>.<span class="ruby-identifier">save_state</span> <span
								class="ruby-comment"># no config.yaml throws a no such container so save so others can use</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">mc</span>.<span
								class="ruby-identifier">save_blueprint</span>(<span
								class="ruby-ivar">@blueprint</span>) <span class="ruby-operator">==</span> <span
								class="ruby-keyword">false</span>
    <span class="ruby-identifier">log_build_errors</span>( <span
								class="ruby-string">&quot;Failed to save blueprint &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-ivar">@blueprint</span>.<span
								class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">bp</span> = <span
								class="ruby-identifier">mc</span>.<span class="ruby-identifier">load_blueprint</span>
  <span class="ruby-identifier">p</span>  <span class="ruby-identifier">bp</span>
  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Launching&quot;</span>)
  <span class="ruby-comment">#this will fail as no api at this stage</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">mc</span>.<span
								class="ruby-identifier">core_api</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">launch_deploy</span>(<span
								class="ruby-identifier">mc</span>) <span class="ruby-operator">==</span> <span
								class="ruby-keyword">false</span>
      <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-string">&quot;Error Failed to Launch&quot;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Applying Volume settings and Log Permissions&quot;</span>)
    <span class="ruby-comment">#FIXME need to check results from following</span>
    <span class="ruby-ivar">@core_api</span>.<span
								class="ruby-identifier">run_volume_builder</span>(<span
								class="ruby-identifier">mc</span> ,<span class="ruby-ivar">@webUser</span>)
    <span class="ruby-comment">#  mc.start_container</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">mc</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_non_persistent_services"
				class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_non_persistent_services</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="create_non_persistent_services-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 660</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_non_persistent_services</span>
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">services</span>.<span
								class="ruby-identifier">each</span>() <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">service_hash</span><span
								class="ruby-operator">|</span>

    <span class="ruby-identifier">service_def</span> =  <span
								class="ruby-identifier">get_service_def</span>(<span
								class="ruby-identifier">service_hash</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_def</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">p</span> <span class="ruby-value">:failed_to_load_service_definition</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:type_path</span>]
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:publisher_namespace</span>]
      <span class="ruby-keyword">return</span> <span
								class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_def</span>[<span
								class="ruby-value">:persistent</span>] <span
								class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">set_top_level_service_params</span>(<span
								class="ruby-identifier">service_hash</span>)
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Attaching Non Persistant Service &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:service_label</span>].<span
								class="ruby-identifier">to_s</span>)

    <span class="ruby-identifier">p</span> <span class="ruby-value">:adding_service</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">service_hash</span>

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@core_api</span>.<span
								class="ruby-identifier">attach_service</span>(<span
								class="ruby-identifier">service_hash</span>) <span
								class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@attached_services</span>.<span
								class="ruby-identifier">push</span>(<span
								class="ruby-identifier">service_hash</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_persistent_services" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_persistent_services</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="create_persistent_services-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 705</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_persistent_services</span>

  <span class="ruby-identifier">service_cnt</span>=<span
								class="ruby-value">0</span>
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">services</span>.<span
								class="ruby-identifier">each</span>() <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">service_hash</span><span
								class="ruby-operator">|</span>

    <span class="ruby-identifier">service_def</span> = <span
								class="ruby-identifier">get_service_def</span>(<span
								class="ruby-identifier">service_hash</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_def</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">p</span> <span class="ruby-value">:failed_to_load_service_definition</span>
      <span class="ruby-identifier">p</span> <span class="ruby-value">:servicetype_name</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:service_type</span>]
      <span class="ruby-identifier">p</span> <span class="ruby-value">:service_provider</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:publisher_namespace</span>]
      <span class="ruby-keyword">return</span> <span
								class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_def</span>[<span
								class="ruby-value">:persistent</span>] <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-operator">+</span><span class="ruby-operator">+</span><span
								class="ruby-identifier">service_cnt</span>
      <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:persistent</span>] =<span
								class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">set_top_level_service_params</span>(<span
								class="ruby-identifier">service_hash</span>)
    <span class="ruby-identifier">free_orphan</span> = <span
								class="ruby-keyword">false</span>

    <span class="ruby-identifier">p</span> <span class="ruby-value">:adding_service</span>

    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;+=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++&quot;</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">service_hash</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;+=++=++=++=++=++=++=++=++=++=++=++=++=++=++=++&quot;</span>
    <span class="ruby-identifier">p</span> <span class="ruby-value">:target_envs</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">service_def</span>[<span
								class="ruby-value">:target_environment_variables</span>]

    <span class="ruby-comment">#FIXME need to unify filesystem creation with attach_service</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:servicetype_name</span>] <span
								class="ruby-operator">==</span> <span class="ruby-string">&quot;filesystem&quot;</span>
      <span class="ruby-identifier">add_file_service</span>(<span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>][<span class="ruby-value">:name</span>], <span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>][<span class="ruby-value">:engine_path</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Attaching Persistant Service &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:service_handle</span>].<span
								class="ruby-identifier">to_s</span>)

    <span class="ruby-identifier">p</span> <span class="ruby-value">:LOOKING_FOR_</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">service_hash</span>
    <span class="ruby-keyword">if</span>  <span class="ruby-ivar">@core_api</span>.<span
								class="ruby-identifier">find_service_consumers</span>(<span
								class="ruby-identifier">service_hash</span>) <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-ivar">@first_build</span> = <span
								class="ruby-keyword">true</span>
      <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:fresh</span>]=<span class="ruby-keyword">true</span>
      <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Creating New Service &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:service_handle</span>].<span
								class="ruby-identifier">to_s</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:fresh</span>]=<span class="ruby-keyword">false</span>
      <span class="ruby-ivar">@first_build</span> = <span
								class="ruby-keyword">false</span>
      <span class="ruby-identifier">new_service_hash</span>  = <span
								class="ruby-identifier">reattach_service</span>(<span
								class="ruby-identifier">service_hash</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_service_hash</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">service_hash</span> = <span
								class="ruby-identifier">new_service_hash</span>
        <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:fresh</span>]=<span class="ruby-keyword">false</span>
        <span class="ruby-comment">#@blueprint_reader.re_set_service(service_cnt,service_hash)#services[service_cnt]=service_hash</span>
        <span class="ruby-identifier">free_orphan</span> = <span
								class="ruby-keyword">true</span>
        <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Reattached Service &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:service_handle</span>].<span
								class="ruby-identifier">to_s</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Failed to reattach &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:service_handle</span>].<span
								class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span
								class="ruby-string">&quot; No Service Found&quot;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">p</span> <span class="ruby-value">:attach_service</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">service_hash</span>
    <span class="ruby-comment">#FIXME release orphan should happen latter unless use reoprhan on rebuild failure</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@core_api</span>.<span
								class="ruby-identifier">attach_service</span>(<span
								class="ruby-identifier">service_hash</span>) <span
								class="ruby-operator">==</span><span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@attached_services</span>.<span
								class="ruby-identifier">push</span>(<span
								class="ruby-identifier">service_hash</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">free_orphan</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">release_orphan</span>(<span
								class="ruby-identifier">service_hash</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-operator">+</span><span class="ruby-operator">+</span><span
								class="ruby-identifier">service_cnt</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_php_ini" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_php_ini</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="create_php_ini-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 593</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_php_ini</span>
  <span class="ruby-constant">FileUtils</span>.<span
								class="ruby-identifier">mkdir_p</span>(<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-constant">File</span>.<span
								class="ruby-identifier">dirname</span>(<span
								class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">CustomPHPiniFile</span>))
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>].<span
								class="ruby-identifier">has_key?</span>(<span class="ruby-value">:custom_php_inis</span>) <span
								class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>][<span class="ruby-value">:custom_php_inis</span>]  <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>

    <span class="ruby-identifier">php_ini_file</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">CustomPHPiniFile</span>,<span
								class="ruby-string">&quot;w&quot;</span>, <span
								class="ruby-value">:crlf_newline</span> =<span
								class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>)
    <span class="ruby-ivar">@blueprint</span>[<span class="ruby-value">:software</span>][<span
								class="ruby-value">:custom_php_inis</span>].<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">php_ini_hash</span><span
								class="ruby-operator">|</span>
      <span class="ruby-identifier">php_ini_file</span>.<span
								class="ruby-identifier">puts</span>(<span
								class="ruby-identifier">php_ini_hash</span>[<span
								class="ruby-value">:content</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">php_ini_file</span>.<span
								class="ruby-identifier">close</span>

  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_post_install_script" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_post_install_script</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="create_post_install_script-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 584</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_post_install_script</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>].<span
								class="ruby-identifier">has_key?</span>(<span class="ruby-value">:custom_post_install_script</span>) <span
								class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>][<span class="ruby-value">:custom_post_install_script</span>] <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">post_install_script_file</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">PostInstallScript</span>,<span
								class="ruby-string">&quot;w&quot;</span>, <span
								class="ruby-value">:crlf_newline</span> =<span
								class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">post_install_script_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>][<span class="ruby-value">:custom_post_install_script</span>])
    <span class="ruby-identifier">post_install_script_file</span>.<span
								class="ruby-identifier">close</span>
    <span class="ruby-constant">File</span>.<span
								class="ruby-identifier">chmod</span>(<span class="ruby-value">0755</span>,<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">PostInstallScript</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_scritps" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_scritps</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="create_scritps-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 558</span>
<span class="ruby-keyword">def</span>   <span class="ruby-identifier">create_scritps</span>

  <span class="ruby-constant">FileUtils</span>.<span
								class="ruby-identifier">mkdir_p</span>(<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">ScriptsDir</span>)
  <span class="ruby-identifier">create_start_script</span>
  <span class="ruby-identifier">create_install_script</span>
  <span class="ruby-identifier">create_post_install_script</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_start_script" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_start_script</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="create_start_script-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 566</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_start_script</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>].<span
								class="ruby-identifier">has_key?</span>(<span class="ruby-value">:custom_start_script</span>) <span
								class="ruby-operator">&amp;&amp;</span>  <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>][<span class="ruby-value">:custom_start_script</span>] <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">start_script_file</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">StartScript</span>,<span
								class="ruby-string">&quot;w&quot;</span>, <span
								class="ruby-value">:crlf_newline</span> =<span
								class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">start_script_file</span>.<span
								class="ruby-identifier">puts</span>(<span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>][<span class="ruby-value">:custom_start_script</span>])
    <span class="ruby-identifier">start_script_file</span>.<span
								class="ruby-identifier">close</span>
    <span class="ruby-constant">File</span>.<span
								class="ruby-identifier">chmod</span>(<span class="ruby-value">0755</span>,<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">StartScript</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-create_template_files" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">create_template_files</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="create_template_files-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 542</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_template_files</span>
  <span class="ruby-keyword">if</span>  <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>].<span
								class="ruby-identifier">has_key?</span>(<span class="ruby-value">:template_files</span>) <span
								class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@blueprint</span>[<span
								class="ruby-value">:software</span>][<span class="ruby-value">:template_files</span>] <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@blueprint</span>[<span class="ruby-value">:software</span>][<span
								class="ruby-value">:template_files</span>].<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">template_hash</span><span
								class="ruby-operator">|</span>
      <span class="ruby-identifier">write_software_file</span>( <span
								class="ruby-string">&quot;/home/engines/templates/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">template_hash</span>[<span
								class="ruby-value">:path</span>],<span class="ruby-identifier">template_hash</span>[<span
								class="ruby-value">:content</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-evaluate_function" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">evaluate_function</span><span
						class="method-args">(function)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="evaluate_function-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 802</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">evaluate_function</span>(<span
								class="ruby-identifier">function</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">function</span>.<span
								class="ruby-identifier">start_with?</span>(<span
								class="ruby-string">&quot;_System&quot;</span>)
    <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">resolve_system_variable</span>(<span
								class="ruby-identifier">function</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">function</span>.<span
								class="ruby-identifier">start_with?</span>(<span
								class="ruby-string">&quot;_Builder&quot;</span>)
    <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">resolve_build_variable</span>(<span
								class="ruby-identifier">function</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">function</span>.<span
								class="ruby-identifier">start_with?</span>(<span
								class="ruby-string">&quot;_Blueprint&quot;</span>)
    <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">resolve_blueprint_variable</span>(<span
								class="ruby-identifier">function</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#if no match return orginial</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">function</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>

<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-fill_in_dynamic_vars" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">fill_in_dynamic_vars</span><span
						class="method-args">(service_hash)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="fill_in_dynamic_vars-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 787</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fill_in_dynamic_vars</span>(<span
								class="ruby-identifier">service_hash</span>)
  <span class="ruby-identifier">p</span> <span class="ruby-node">&quot;FILLING_+@+#+@+@+@+@+@+&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_hash</span>.<span
								class="ruby-identifier">has_key?</span>(<span class="ruby-value">:variables</span>) <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span> <span
								class="ruby-operator">||</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>] <span
								class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>].<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">variable</span><span
								class="ruby-operator">|</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">variable</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">variable</span>[<span
								class="ruby-value">1</span>] <span class="ruby-operator">!=</span> <span
								class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span
								class="ruby-identifier">variable</span>[<span class="ruby-value">1</span>].<span
								class="ruby-identifier">start_with?</span>(<span
								class="ruby-string">&quot;_&quot;</span>)
      <span class="ruby-comment">#variable[1].sub!(/\$/,&quot;&quot;)</span>
      <span class="ruby-identifier">result</span> = <span
								class="ruby-identifier">evaluate_function</span>(<span
								class="ruby-identifier">variable</span>[<span class="ruby-value">1</span>])
      <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>][<span
								class="ruby-identifier">variable</span>[<span class="ruby-value">0</span>]] = <span
								class="ruby-identifier">result</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-get_blueprint_from_repo" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">get_blueprint_from_repo</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="get_blueprint_from_repo-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 346</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_blueprint_from_repo</span>
  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Backup last build&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">backup_lastbuild</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Cloning Blueprint&quot;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">clone_repo</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-get_build_err_stream" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">get_build_err_stream</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="get_build_err_stream-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 135</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_build_err_stream</span>
  <span class="ruby-ivar">@error_pipe_rd</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-get_build_log_stream" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">get_build_log_stream</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="get_build_log_stream-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 131</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_build_log_stream</span>
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@log_pipe_rd</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-get_service_def" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">get_service_def</span><span
						class="method-args">(service_hash)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="get_service_def-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 685</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_service_def</span>(<span
								class="ruby-identifier">service_hash</span>)
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:type_path</span>]
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:publisher_namespace</span>]
  <span class="ruby-keyword">return</span>     <span
								class="ruby-constant">SoftwareServiceDefinition</span>.<span
								class="ruby-identifier">find</span>(<span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:type_path</span>], <span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:publisher_namespace</span>] )
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-launch_deploy" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">launch_deploy</span><span
						class="method-args">(managed_container)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="launch_deploy-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 306</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">launch_deploy</span> <span
								class="ruby-identifier">managed_container</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Launching Engine&quot;</span>)
    <span class="ruby-identifier">retval</span> =  <span
								class="ruby-identifier">managed_container</span>.<span
								class="ruby-identifier">create_container</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">retval</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">puts</span> <span
								class="ruby-string">&quot;Failed to Start Container &quot;</span> <span
								class="ruby-operator">+</span>  <span class="ruby-identifier">managed_container</span>.<span
								class="ruby-identifier">last_error</span>
      <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-string">&quot;Failed to Launch&quot;</span>)

    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">retval</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>

    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-load_blueprint" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">load_blueprint</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="load_blueprint-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_blueprint</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Reading Blueprint&quot;</span>)
    <span class="ruby-identifier">blueprint_file_name</span>= <span
								class="ruby-identifier">get_basedir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/blueprint.json&quot;</span>
    <span class="ruby-identifier">blueprint_file</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span
								class="ruby-identifier">blueprint_file_name</span>,<span
								class="ruby-string">&quot;r&quot;</span>)
    <span class="ruby-identifier">blueprint_json_str</span> = <span
								class="ruby-identifier">blueprint_file</span>.<span
								class="ruby-identifier">read</span>
    <span class="ruby-identifier">blueprint_file</span>.<span
								class="ruby-identifier">close</span>

    <span class="ruby-comment"># @blueprint = JSON.parse(blueprint_json_str)</span>
    <span class="ruby-identifier">json_hash</span> = <span
								class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span
								class="ruby-identifier">blueprint_json_str</span>)
    <span class="ruby-identifier">p</span> <span class="ruby-value">:symbolized_hash</span>
    <span class="ruby-comment">#      test_hash = json_hash</span>
    <span class="ruby-comment">#      test_hash.keys.each do |key|</span>
    <span class="ruby-comment">#        test_hash[(key.to_sym rescue key) || key] = myhash.delete(key)</span>
    <span class="ruby-comment">#      end</span>
    <span class="ruby-comment">#      p test_hash</span>
    <span class="ruby-identifier">hash</span> =  <span
								class="ruby-constant">SystemUtils</span>.<span
								class="ruby-identifier">symbolize_keys</span>(<span
								class="ruby-identifier">json_hash</span>)
    <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">hash</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-log_build_errors" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">log_build_errors</span><span
						class="method-args">(line)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="log_build_errors-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 148</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-identifier">line</span>)

  <span class="ruby-ivar">@err_file</span>.<span class="ruby-identifier">puts</span>(<span
								class="ruby-identifier">line</span>)
  <span class="ruby-ivar">@err_file</span>.<span class="ruby-identifier">flush</span>
  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;ERROR:&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">line</span>)

  <span class="ruby-comment">#    @error_pipe_wr.puts(line)</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-log_build_output" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">log_build_output</span><span
						class="method-args">(line)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="log_build_output-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 139</span>
<span class="ruby-keyword">def</span>  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-identifier">line</span>)
  <span class="ruby-ivar">@log_file</span>.<span class="ruby-identifier">puts</span>(<span
								class="ruby-identifier">line</span>)
  <span class="ruby-ivar">@log_file</span>.<span class="ruby-identifier">flush</span>
  <span class="ruby-comment"># @log_pipe_wr.puts(line)</span>
<span class="ruby-keyword">rescue</span>
  <span class="ruby-keyword">return</span>

<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-post_failed_build_clean_up" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">post_failed_build_clean_up</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="post_failed_build_clean_up-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 528</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post_failed_build_clean_up</span>
  <span class="ruby-comment">#remove containers</span>
  <span class="ruby-comment">#remove persistent services (if created/new)</span>
  <span class="ruby-comment">#deregister non persistent services (if created)</span>
  <span class="ruby-identifier">p</span> <span class="ruby-value">:Clean_up_Failed_build</span>
  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">services</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">service_hash</span><span
								class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:fresh</span>] <span class="ruby-operator">==</span> <span
								class="ruby-keyword">true</span>
      <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:delete_persistent</span>]=<span
								class="ruby-keyword">true</span>
      <span class="ruby-ivar">@core_api</span>.<span
								class="ruby-identifier">dettach_service</span>(<span
								class="ruby-identifier">service_hash</span>) <span
								class="ruby-comment">#true is delete persistent</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">close_all</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-process_dockerfile_tmpl" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">process_dockerfile_tmpl</span><span
						class="method-args">(filename)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="process_dockerfile_tmpl-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 638</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_dockerfile_tmpl</span>(<span
								class="ruby-identifier">filename</span>)
  <span class="ruby-identifier">p</span> <span class="ruby-value">:dockerfile_template_processing</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-identifier">template</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span
								class="ruby-identifier">filename</span>)

  <span class="ruby-identifier">template</span> = <span
								class="ruby-identifier">process_templated_string</span>(<span
								class="ruby-identifier">template</span>)
  <span class="ruby-identifier">output_filename</span> = <span
								class="ruby-identifier">filename</span>.<span
								class="ruby-identifier">sub</span>(<span class="ruby-regexp">/.tmpl/</span>,<span
								class="ruby-string">&quot;&quot;</span>)

  <span class="ruby-identifier">out_file</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span
								class="ruby-identifier">output_filename</span>,<span
								class="ruby-string">&quot;w&quot;</span>)
  <span class="ruby-identifier">out_file</span>.<span
								class="ruby-identifier">write</span>(<span
								class="ruby-identifier">template</span>)
  <span class="ruby-identifier">out_file</span>.<span
								class="ruby-identifier">close</span>()
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-read_web_port" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">read_web_port</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="read_web_port-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 362</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">read_web_port</span>
  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Setting Web port&quot;</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">stef</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>( <span
								class="ruby-identifier">get_basedir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/home/stack.env&quot;</span>,<span
								class="ruby-string">&quot;r&quot;</span>)
    <span class="ruby-keyword">while</span> <span
								class="ruby-identifier">line</span>=<span
								class="ruby-identifier">stef</span>.<span
								class="ruby-identifier">gets</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span
								class="ruby-identifier">include?</span>(<span
								class="ruby-string">&quot;PORT&quot;</span>)
        <span class="ruby-identifier">i</span>= <span
								class="ruby-identifier">line</span>.<span
								class="ruby-identifier">split</span>(<span class="ruby-string">&#39;=&#39;</span>)
        <span class="ruby-ivar">@webPort</span>= <span
								class="ruby-identifier">i</span>[<span class="ruby-value">1</span>].<span
								class="ruby-identifier">strip</span>
        <span class="ruby-identifier">p</span> <span class="ruby-value">:web_port_line</span>
        <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">line</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">p</span> <span class="ruby-ivar">@webPort</span>
      <span class="ruby-identifier">puts</span>(<span class="ruby-ivar">@webPort</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-comment">#      throw BuildException.new(e,&quot;setting web port&quot;)</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-read_web_user" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">read_web_user</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="read_web_user-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 383</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">read_web_user</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Read Web User&quot;</span>)
    <span class="ruby-identifier">stef</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>( <span
								class="ruby-identifier">get_basedir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/home/stack.env&quot;</span>,<span
								class="ruby-string">&quot;r&quot;</span>)
    <span class="ruby-keyword">while</span> <span
								class="ruby-identifier">line</span>=<span
								class="ruby-identifier">stef</span>.<span
								class="ruby-identifier">gets</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span
								class="ruby-identifier">include?</span>(<span
								class="ruby-string">&quot;USER&quot;</span>)
        <span class="ruby-identifier">i</span>= <span
								class="ruby-identifier">line</span>.<span
								class="ruby-identifier">split</span>(<span class="ruby-string">&#39;=&#39;</span>)
        <span class="ruby-ivar">@webUser</span>= <span
								class="ruby-identifier">i</span>[<span class="ruby-value">1</span>].<span
								class="ruby-identifier">strip</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-reattach_service" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">reattach_service</span><span
						class="method-args">(service_hash)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="reattach_service-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 776</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reattach_service</span>(<span
								class="ruby-identifier">service_hash</span>)
  <span class="ruby-identifier">sm</span> = <span class="ruby-ivar">@core_api</span>.<span
								class="ruby-identifier">loadServiceManager</span>()
  <span class="ruby-identifier">resuse_service_hash</span> = <span
								class="ruby-identifier">sm</span>.<span class="ruby-identifier">reparent_orphan</span>(<span
								class="ruby-identifier">service_hash</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resuse_service_hash</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-rebuild_managed_container" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">rebuild_managed_container</span><span
						class="method-args">(engine)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="rebuild_managed_container-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 856</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rebuild_managed_container</span>  <span
								class="ruby-identifier">engine</span>
  <span class="ruby-ivar">@engine</span>  = <span
								class="ruby-identifier">engine</span>
  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Starting Rebuild&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">backup_lastbuild</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">setup_rebuild</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">build_container</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-release_orphan" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">release_orphan</span><span
						class="method-args">(service_hash)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="release_orphan-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 782</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">release_orphan</span>(<span
								class="ruby-identifier">service_hash</span>)
  <span class="ruby-identifier">sm</span> = <span class="ruby-ivar">@core_api</span>.<span
								class="ruby-identifier">loadServiceManager</span>()
  <span class="ruby-identifier">sm</span>.<span class="ruby-identifier">release_orphan</span>(<span
								class="ruby-identifier">service_hash</span>)
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-set_top_level_service_params"
				class="method-detail ">

				<div class="method-heading">
					<span class="method-name">set_top_level_service_params</span><span
						class="method-args">(service_hash)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="set_top_level_service_params-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 691</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_top_level_service_params</span>(<span
								class="ruby-identifier">service_hash</span>)
  <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:parent_engine</span>]=<span
								class="ruby-ivar">@container_name</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_hash</span>.<span
								class="ruby-identifier">has_key?</span>(<span class="ruby-value">:variables</span>) <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>] = <span
								class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>][<span class="ruby-value">:parent_engine</span>]=<span
								class="ruby-ivar">@container_name</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>].<span
								class="ruby-identifier">has_key?</span>(<span class="ruby-value">:name</span>) <span
								class="ruby-operator">==</span> <span class="ruby-keyword">true</span>  <span
								class="ruby-operator">&amp;&amp;</span> <span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>][<span class="ruby-value">:name</span>] <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:service_handle</span>] = <span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>][<span class="ruby-value">:name</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:service_handle</span>] = <span
								class="ruby-ivar">@container_name</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-setup_default_files" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">setup_default_files</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">

					<p>def create_cron_service</p>

					<pre class="ruby">
						<span class="ruby-keyword">begin</span>

  <span class="ruby-identifier">log_build_output</span>(<span
							class="ruby-string">&quot;Cron file&quot;</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
							class="ruby-identifier">cron_jobs</span> <span
							class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span
							class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@blueprint_reader</span>.<span
							class="ruby-identifier">cron_jobs</span>.<span
							class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span><span
							class="ruby-value">0</span>

    <span class="ruby-ivar">@blueprint_reader</span>.<span
							class="ruby-identifier">cron_jobs</span>.<span
							class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
							class="ruby-operator">|</span><span class="ruby-identifier">cj</span><span
							class="ruby-operator">|</span>
      <span class="ruby-identifier">cj_hash</span> = <span
							class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">cj_hash</span>[:<span
							class="ruby-identifier">name</span>] =<span class="ruby-ivar">@container_name</span>
      <span class="ruby-identifier">cj_hash</span>[:<span
							class="ruby-identifier">container_name</span>] = <span
							class="ruby-ivar">@container_name</span>
      <span class="ruby-identifier">cj_hash</span>[:<span
							class="ruby-identifier">cron_job</span>]=<span
							class="ruby-identifier">cj</span>
      <span class="ruby-identifier">cj_hash</span>[:<span
							class="ruby-identifier">parent_engine</span>] = <span
							class="ruby-ivar">@containerName</span>
      <span class="ruby-comment">#               cron_file.puts(cj)</span>
      <span class="ruby-comment">#               p :write_cron_job</span>
      <span class="ruby-comment">#               p cj</span>
      <span class="ruby-ivar">@cron_job_list</span>.<span
							class="ruby-identifier">push</span>(<span class="ruby-identifier">cj_hash</span>)
      <span class="ruby-identifier">p</span> <span class="ruby-ivar">@cron_job_list</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#             cron_file.close</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>

<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
							class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
  <span class="ruby-identifier">log_exception</span>(<span
							class="ruby-identifier">e</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span>
</pre>

					<p>end</p>




					<div class="method-source-code" id="setup_default_files-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 262</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_default_files</span>
  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Setup Default Files&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">setup_global_defaults</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span
								class="ruby-identifier">setup_framework_defaults</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-setup_framework_defaults" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">setup_framework_defaults</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="setup_framework_defaults-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 335</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_framework_defaults</span>
  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Copy in default templates&quot;</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">cmd</span>=  <span class="ruby-string">&quot;cp -r &quot;</span> <span
								class="ruby-operator">+</span>  <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">DeploymentTemplates</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span> <span
								class="ruby-operator">+</span>  <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">framework</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/* &quot;</span>  <span
								class="ruby-operator">+</span> <span class="ruby-identifier">get_basedir</span>
    <span class="ruby-identifier">system</span>  <span
								class="ruby-identifier">cmd</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-setup_framework_logging" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">setup_framework_logging</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="setup_framework_logging-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 157</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_framework_logging</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">rmt_log_dir_var_fname</span>=<span
								class="ruby-identifier">get_basedir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/home/LOG_DIR&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span
								class="ruby-identifier">exist?</span>(<span
								class="ruby-identifier">rmt_log_dir_var_fname</span>)
      <span class="ruby-identifier">rmt_log_dir_varfile</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span
								class="ruby-identifier">rmt_log_dir_var_fname</span>)
      <span class="ruby-identifier">rmt_log_dir</span> = <span
								class="ruby-identifier">rmt_log_dir_varfile</span>.<span
								class="ruby-identifier">read</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">rmt_log_dir</span>=<span
								class="ruby-string">&quot;/var/log&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">local_log_dir</span> = <span
								class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">SystemLogRoot</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/containers/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-ivar">@container_name</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">Dir</span>.<span
								class="ruby-identifier">exist?</span>(<span
								class="ruby-identifier">local_log_dir</span>) <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-constant">Dir</span>.<span
								class="ruby-identifier">mkdir</span>( <span
								class="ruby-identifier">local_log_dir</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot; -v &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">local_log_dir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;:&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">rmt_log_dir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;:rw &quot;</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-setup_global_defaults" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">setup_global_defaults</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="setup_global_defaults-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 324</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_global_defaults</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Setup global defaults&quot;</span>)
    <span class="ruby-identifier">cmd</span>=  <span class="ruby-string">&quot;cp -r &quot;</span> <span
								class="ruby-operator">+</span>  <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">DeploymentTemplates</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/global/* &quot;</span>  <span
								class="ruby-operator">+</span> <span class="ruby-identifier">get_basedir</span>
    <span class="ruby-identifier">system</span>  <span
								class="ruby-identifier">cmd</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-setup_rebuild" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">setup_rebuild</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="setup_rebuild-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 868</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_rebuild</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Setting up rebuild&quot;</span>)
    <span class="ruby-constant">FileUtils</span>.<span
								class="ruby-identifier">mkdir_p</span>(<span
								class="ruby-identifier">get_basedir</span>)
    <span class="ruby-identifier">blueprint</span> = <span
								class="ruby-ivar">@core_api</span>.<span class="ruby-identifier">load_blueprint</span>(<span
								class="ruby-ivar">@engine</span>)
    <span class="ruby-identifier">statefile</span>= <span
								class="ruby-identifier">get_basedir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/blueprint.json&quot;</span>
    <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span
								class="ruby-identifier">new</span>(<span class="ruby-identifier">statefile</span>,<span
								class="ruby-constant">File</span><span class="ruby-operator">::</span><span
								class="ruby-constant">CREAT</span><span class="ruby-operator">|</span><span
								class="ruby-constant">File</span><span class="ruby-operator">::</span><span
								class="ruby-constant">TRUNC</span><span class="ruby-operator">|</span><span
								class="ruby-constant">File</span><span class="ruby-operator">::</span><span
								class="ruby-constant">RDWR</span>, <span class="ruby-value">0644</span>)
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span
								class="ruby-identifier">blueprint</span>.<span
								class="ruby-identifier">to_json</span>)
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
    <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-tail_of_build_log" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">tail_of_build_log</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="tail_of_build_log-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 817</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tail_of_build_log</span>
  <span class="ruby-identifier">retval</span> = <span
								class="ruby-constant">String</span>.<span
								class="ruby-identifier">new</span>
  <span class="ruby-identifier">lines</span> = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">readlines</span>(<span
								class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">DeploymentDir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/build.out&quot;</span>)
  <span class="ruby-identifier">lines_count</span> = <span
								class="ruby-identifier">lines</span>.<span
								class="ruby-identifier">count</span> <span class="ruby-value">-1</span>
  <span class="ruby-identifier">start</span> = <span
								class="ruby-identifier">lines_count</span> <span
								class="ruby-operator">-</span> <span class="ruby-value">10</span>
  <span class="ruby-keyword">for</span> <span class="ruby-identifier">n</span> <span
								class="ruby-keyword">in</span> <span class="ruby-identifier">start</span><span
								class="ruby-operator">..</span><span class="ruby-identifier">lines_count</span>
    <span class="ruby-identifier">retval</span><span
								class="ruby-operator">+=</span><span class="ruby-identifier">lines</span>[<span
								class="ruby-identifier">n</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">retval</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-write_software_file" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">write_software_file</span><span
						class="method-args">(container_filename_path,content)</span> <span
						class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="write_software_file-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 614</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_software_file</span>(<span
								class="ruby-identifier">container_filename_path</span>,<span
								class="ruby-identifier">content</span>)
  <span class="ruby-identifier">dir</span> = <span class="ruby-constant">File</span>.<span
								class="ruby-identifier">dirname</span>(<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-identifier">container_filename_path</span>)
  <span class="ruby-identifier">p</span> <span class="ruby-value">:dir_for_write_software_file</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">dir</span>

  <span class="ruby-keyword">if</span> <span class="ruby-constant">Dir</span>.<span
								class="ruby-identifier">exist?</span>(<span
								class="ruby-identifier">dir</span>) <span class="ruby-operator">==</span> <span
								class="ruby-keyword">false</span>
    <span class="ruby-constant">FileUtils</span>.<span
								class="ruby-identifier">mkdir_p</span>(<span
								class="ruby-identifier">dir</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">out_file</span>  = <span
								class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span
								class="ruby-identifier">get_basedir</span>() <span
								class="ruby-operator">+</span> <span class="ruby-identifier">container_filename_path</span> ,<span
								class="ruby-string">&quot;w&quot;</span>, <span
								class="ruby-value">:crlf_newline</span> =<span
								class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">content</span> = <span
								class="ruby-identifier">process_templated_string</span>(<span
								class="ruby-identifier">content</span>)
  <span class="ruby-identifier">out_file</span>.<span
								class="ruby-identifier">puts</span>(<span
								class="ruby-identifier">content</span>)

  <span class="ruby-identifier">out_file</span>.<span
								class="ruby-identifier">close</span>

<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>=<span
								class="ruby-operator">&gt;</span><span class="ruby-identifier">e</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">out_file</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">contents</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">out_file</span>.<span
								class="ruby-identifier">puts</span>(<span
								class="ruby-identifier">content</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">out_file</span>.<span
								class="ruby-identifier">close</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">log_exception</span>(<span
								class="ruby-identifier">e</span>)
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


		</section>

		<section id="protected-instance-5Buntitled-5D-method-details"
			class="method-section">
			<header>
				<h3>Protected Instance Methods</h3>
			</header>


			<div id="method-i-debug" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">debug</span><span class="method-args">(fld)</span>

					<span class="method-click-advice">click to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="debug-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 960</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">debug</span>(<span
								class="ruby-identifier">fld</span>)
  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;ERROR: &quot;</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">fld</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-fill_service_environment_variables"
				class="method-detail ">

				<div class="method-heading">
					<span class="method-name">fill_service_environment_variables</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code"
						id="fill_service_environment_variables-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 933</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fill_service_environment_variables</span>
  <span class="ruby-identifier">p</span> <span class="ruby-value">:fill_service_environment_variables</span>
  <span class="ruby-identifier">services</span> =<span class="ruby-ivar">@attached_services</span> <span
								class="ruby-comment">#@blueprint_reader.services</span>
  <span class="ruby-identifier">services</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">service_hash</span><span
								class="ruby-operator">|</span>
    <span class="ruby-identifier">service_def</span> =  <span
								class="ruby-identifier">get_service_def</span>(<span
								class="ruby-identifier">service_hash</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_def</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">service_environment_variables</span> = <span
								class="ruby-identifier">service_def</span>[<span
								class="ruby-value">:target_environment_variables</span>]
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">service_environment_variables</span> <span
								class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">service_environment_variables</span>.<span
								class="ruby-identifier">values</span>.<span
								class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">env_variable_pair</span><span
								class="ruby-operator">|</span>
          <span class="ruby-identifier">env_name</span> = <span
								class="ruby-identifier">env_variable_pair</span>[<span
								class="ruby-value">:environment_name</span>]
          <span class="ruby-identifier">value_name</span> = <span
								class="ruby-identifier">env_variable_pair</span>[<span
								class="ruby-value">:variable_name</span>]
          <span class="ruby-identifier">value</span>=<span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:variables</span>][<span
								class="ruby-identifier">value_name</span>.<span
								class="ruby-identifier">to_sym</span>]
          <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">service_hash</span>
          <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">env_variable_pair</span>
          <span class="ruby-ivar">@blueprint_reader</span>.<span
								class="ruby-identifier">environments</span>.<span
								class="ruby-identifier">push</span>( <span class="ruby-constant">EnvironmentVariable</span>.<span
								class="ruby-identifier">new</span>(<span class="ruby-identifier">env_name</span>,<span
								class="ruby-identifier">value</span>,<span class="ruby-keyword">false</span>,<span
								class="ruby-keyword">true</span>,<span class="ruby-keyword">false</span>,<span
								class="ruby-identifier">service_hash</span>[<span
								class="ruby-value">:type_path</span>] <span
								class="ruby-operator">+</span> <span class="ruby-identifier">env_name</span>,<span
								class="ruby-keyword">false</span>)) <span class="ruby-comment"># env_name , value</span>
        <span class="ruby-keyword">end</span>                                                      <span
								class="ruby-comment">#(name,value,setatrun,mandatory,build_time_only,label,immutable)</span>
        <span class="ruby-identifier">p</span> <span class="ruby-value">:no_target_envs</span>
        <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">service_hash</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">p</span> <span class="ruby-value">:Failed_to_load_service_def</span>
      <span class="ruby-identifier">p</span> <span
								class="ruby-identifier">service_hash</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-get_basedir" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">get_basedir</span><span
						class="method-args">()</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="get_basedir-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 1032</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_basedir</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">SysConfig</span>.<span
								class="ruby-constant">DeploymentDir</span> <span
								class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-ivar">@build_name</span>
<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


			<div id="method-i-run_system" class="method-detail ">

				<div class="method-heading">
					<span class="method-name">run_system</span><span
						class="method-args">(cmd)</span> <span class="method-click-advice">click
						to toggle source</span>

				</div>


				<div class="method-description">






					<div class="method-source-code" id="run_system-source">
						<pre>
							<span class="ruby-comment"># File engine_builder/EngineBuilder.rb, line 967</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">run_system</span>(<span
								class="ruby-identifier">cmd</span>)
  <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-string">&quot;Running &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">cmd</span>)
  <span class="ruby-identifier">ret_val</span>=<span
								class="ruby-keyword">false</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-constant">String</span>.<span
								class="ruby-identifier">new</span>
  <span class="ruby-identifier">error_mesg</span> = <span
								class="ruby-constant">String</span>.<span
								class="ruby-identifier">new</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">Open3</span>.<span
								class="ruby-identifier">popen3</span>( <span
								class="ruby-identifier">cmd</span> ) <span class="ruby-keyword">do</span> <span
								class="ruby-operator">|</span><span class="ruby-identifier">stdin</span>, <span
								class="ruby-identifier">stdout</span>, <span
								class="ruby-identifier">stderr</span>, <span
								class="ruby-identifier">th</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">oline</span> = <span
								class="ruby-constant">String</span>.<span
								class="ruby-identifier">new</span>
      <span class="ruby-identifier">stderr_is_open</span>=<span
								class="ruby-keyword">true</span>

      <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">stdout</span>.<span
								class="ruby-identifier">each</span> { <span
								class="ruby-operator">|</span><span class="ruby-identifier">line</span><span
								class="ruby-operator">|</span>
          <span class="ruby-comment">#  print line</span>
          <span class="ruby-identifier">line</span> = <span
								class="ruby-identifier">line</span>.<span
								class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\\&quot;/</span>,<span
								class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-identifier">res</span> <span
								class="ruby-operator">+=</span> <span class="ruby-identifier">line</span>.<span
								class="ruby-identifier">chop</span>
          <span class="ruby-identifier">oline</span> = <span
								class="ruby-identifier">line</span>
          <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-identifier">line</span>)
          <span class="ruby-keyword">if</span> <span
								class="ruby-identifier">stderr_is_open</span>
            <span class="ruby-identifier">err</span>  = <span
								class="ruby-identifier">stderr</span>.<span
								class="ruby-identifier">read_nonblock</span>(<span
								class="ruby-value">1000</span>)
            <span class="ruby-identifier">error_mesg</span> <span
								class="ruby-operator">+=</span> <span class="ruby-identifier">err</span>
            <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-identifier">err</span>)
          <span class="ruby-keyword">end</span>
        }
      <span class="ruby-keyword">rescue</span> <span
								class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span
								class="ruby-constant">EIO</span>
        <span class="ruby-identifier">res</span> <span
								class="ruby-operator">+=</span> <span class="ruby-identifier">line</span>.<span
								class="ruby-identifier">chop</span>
        <span class="ruby-identifier">log_build_output</span>(<span
								class="ruby-identifier">oline</span>)
        <span class="ruby-keyword">if</span> <span
								class="ruby-identifier">stderr_is_open</span>
          <span class="ruby-identifier">err</span>  = <span
								class="ruby-identifier">stderr</span>.<span
								class="ruby-identifier">read_nonblock</span>(<span
								class="ruby-value">1000</span>)
          <span class="ruby-identifier">error_mesg</span> <span
								class="ruby-operator">+=</span> <span class="ruby-identifier">err</span>
          <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-identifier">err</span>)
          <span class="ruby-identifier">p</span> <span
								class="ruby-value">:EIO_retry</span>
          <span class="ruby-keyword">retry</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">rescue</span>  <span
								class="ruby-constant">IO</span><span class="ruby-operator">::</span><span
								class="ruby-constant">WaitReadable</span>

        <span class="ruby-comment"># p :wait_readable_retrt</span>
        <span class="ruby-keyword">retry</span>
      <span class="ruby-keyword">rescue</span> <span
								class="ruby-constant">EOFError</span>
        <span class="ruby-keyword">if</span> <span
								class="ruby-identifier">stdout</span>.<span
								class="ruby-identifier">closed?</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
          <span class="ruby-identifier">stderr_is_open</span> = <span
								class="ruby-keyword">false</span>
          <span class="ruby-identifier">p</span> <span
								class="ruby-value">:EOF_retry</span>
          <span class="ruby-keyword">retry</span>
        <span class="ruby-keyword">elsif</span>  <span
								class="ruby-identifier">stderr</span>.<span
								class="ruby-identifier">closed?</span> <span
								class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-identifier">error_mesg</span>)
          <span class="ruby-keyword">return</span> <span
								class="ruby-keyword">true</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">err</span>  = <span
								class="ruby-identifier">stderr</span>.<span
								class="ruby-identifier">read_nonblock</span>(<span
								class="ruby-value">1000</span>)
          <span class="ruby-identifier">error_mesg</span> <span
								class="ruby-operator">+=</span> <span class="ruby-identifier">err</span>
          <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-identifier">err</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">log_build_errors</span>(<span
								class="ruby-identifier">error_mesg</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">error_mesg</span>.<span
								class="ruby-identifier">include?</span>(<span
								class="ruby-string">&quot;Error:&quot;</span>) <span
								class="ruby-operator">||</span> <span class="ruby-identifier">error_mesg</span>.<span
								class="ruby-identifier">include?</span>(<span
								class="ruby-string">&quot;FATA&quot;</span>)
      <span class="ruby-identifier">p</span> <span class="ruby-string">&quot;docker_cmd error &quot;</span> <span
								class="ruby-operator">+</span> <span class="ruby-identifier">error_mesg</span>
      <span class="ruby-identifier">last_error</span> = <span
								class="ruby-identifier">error_mesg</span>
      <span class="ruby-keyword">return</span> <span
								class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">p</span> <span class="ruby-value">:build_suceeded</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span>
						</pre>
					</div>

				</div>




			</div>


		</section>

	</section>
	</main>


	<footer id="validator-badges" role="contentinfo">
		<p>
			<a href="http://validator.w3.org/check/referer">Validate</a>
		<p>
			Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
		<p>
			Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a>
			by <a href="http://deveiate.org">Michael Granger</a>.
	</footer>